!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Ballpen=e()}(this,function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),i=function(){function i(e,n){t(this,i),this.init(e,n),this.scan(this.$el)}return n(i,[{key:"init",value:function(t,e){var n=this;if(this.$el=document.querySelector(t),this.$el||i.throwError('Find an invalid root element when initializing Ballpen.js -> "'+t+'"','Well, you should set a valid root element for Ballpen.js first constructor parameter, eg: "#app", "#container".'),e.events&&(this.$eventList={},this.initEventList(e.events)),e.data&&(this.$dataListPure=e.data,this.$dataList=i.clone(e.data)),e.watchers){this.watchersHook=new Map;var a=e.watchers;for(var r in a){var o=r,s=a[r].handler;this.watchersHook.set(o,s)}this.watchersHook.forEach(function(t,e){i.renderObjectValueByPath(n.$dataList,e,n.setProxy(i.parseData(e,n.$dataList).data,e,t,t))})}this.$registers=[]}},{key:"setProxy",value:function(t,e){var n=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=(i.parseData(e,this.$dataListPure).data,{get:function(t,a){return r&&r.call(n,i.parseData(e,n.$dataListPure).data,i.parseData(e,n.$dataList).data),t[a]},set:function(t,r,o,s){var l=void 0;return l=/^\$/gi.test(r)?r.substring(1):r,t[l]=o,l===r&&a&&a.call(n,i.parseData(e,n.$dataListPure).data,i.parseData(e,n.$dataList).data),!0},defineProperty:function(t,e,n){return Reflect.defineProperty(t,e,n)}});return new Proxy(t,o)}},{key:"initEventList",value:function(t){if(t){var e=t;for(var n in e)this.$eventList[n]={},this.$eventList[n].type="",this.$eventList[n].fn=e[n]}}},{key:"scan",value:function(t){for(var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=function(n){var i=t.children[n];if(i.hasAttributes()){for(var a=i.attributes,r=[],o=0;o<a.length;o++){var s=a.item(o);if(r.push(s.name),/bp-event:/gi.test(s.name)){var l=s.name.split(":")[1],c=s.value;e.bindEvent(i,c,l,e.$dataList)}if(/bp-bind:/gi.test(s.name)){var u=s.name.split(":")[1],d=s.value;e.bindBind(i,d,u)}}if(r.includes("bp-pre"))return"continue";if(r.includes("bp-for"))return e.bindFor(i),"continue";r.includes("bp-model")&&e.bindModel(i),r.includes("bp-class")&&e.bindClass(i),r.includes("bp-show")&&e.bindShow(i)}var h=i.childNodes;h.forEach(function(t,n){t.nodeType===Node.TEXT_NODE&&e.bindMoustache(i,t)}),i.children.length>0&&e.scan(i,!1)},a=0;a<t.children.length;a++){i(a)}n&&(this.attach(),this.$el.removeAttribute("bp-shade"))}},{key:"bindShow",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=i.wrapAbsPath(n,t.getAttribute("bp-show"));i.ignoreInnerDirectives(a,[],function(t){var n=i.parseData(a,e.$dataList),r=t.style;n.data?r.removeProperty?r.removeProperty("display"):r.removeAttribute("display"):r.display="none",e.register(e.$dataList,e.$dataListPure,n.path,function(t,e){e?r.removeProperty?r.removeProperty("display"):r.removeAttribute("display"):r.display="none"})},t)}},{key:"bindModel",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=i.wrapAbsPath(n,t.getAttribute("bp-model"));i.ignoreInnerDirectives(a,[/^@{([\d]+)}$/gi],function(t){if(/^@{([\d]+)}$/gi.test(a)){var n=a.match(/^@{([\d]+)}$/)[1];"INPUT"===t.tagName?t.value=n:t.innerText=n}else{var r=i.parseData(a,e.$dataList);"INPUT"===t.tagName?t.value=r.data:t.innerText=r.data,e.register(e.$dataList,e.$dataListPure,r.path,function(e,n){"INPUT"===t.tagName?t.value=n:t.innerText=n})}},t)}},{key:"bindMoustache",value:function(t,e){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=e.nodeValue,o=e.nodeValue,s=o.match(/{{.*?}}/gi),l={};if(i.isArray(s)&&s.length>0){s.forEach(function(t){var s=t.slice(2,-2).trim();/^@{([\d]+)}$/gi.test(s)?l[t]=s.match(/^@{([\d]+)}$/)[1]:!function(){var c=i.parseData(i.wrapAbsPath(a,s),n.$dataList);l[t]=c.data,n.register(n.$dataList,n.$dataListPure,c.path,function(t,n){l["{{ "+c.path.join(".")+" }}"]=n;for(var i in l)o=r.replace(i,l[i]);e.nodeValue=o})}()});for(var c in l)o=r.replace(c,l[c])}e.nodeValue=o}},{key:"bindClass",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=i.wrapAbsPath(n,t.getAttribute("bp-class"));i.ignoreInnerDirectives(a,[],function(t){var n=i.parseData(a,e.$dataList);t.classList.contains(n.data)||t.classList.add(n.data),e.register(e.$dataList,e.$dataListPure,n.path,function(e,n){t.classList.remove(e),t.classList.contains(n)||t.classList.add(n)})},t)}},{key:"bindEvent",value:function(t,e,n,a){var r=this,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};i.ignoreInnerDirectives(e,[],function(t,e,n,i){r.$eventList[e].type=n,t.addEventListener(n,function(){r.$eventList[e].fn.call(r.$dataList,t,i,o)})},t,e,n,a,o)}},{key:"bindBind",value:function(t,e,n){var a=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];i.ignoreInnerDirectives(e,[],function(t,e,n){var o=i.wrapAbsPath(r,e),s=i.parseData(o,a.$dataList);t.setAttribute(n,s.data),a.register(a.$dataList,a.$dataListPure,s.path,function(e,i){t.setAttribute(n,i)})},t,e,n)}},{key:"bindFor",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.getAttribute("bp-for").split(/\s+in\s+/),o=r[1],s=r[0],l=i.randomSequence(12);if(/^@/gi.test(s)||i.throwError('Invalid alias name when initializing a "bp-for" condition -> "'+s+'".','Please make sure the alias name is start with a "@" symbol.'),/\./gi.test(o)){var c=o.split(".");n[o]=n[c[0]]+"."+c[1]}else n[o]=o;for(var u=i.clone(n),d=i.clone(a),h=i.parseData(n[o],this.$dataList),f=t.parentNode,v=document.createDocumentFragment(),p=0;p<h.data.length;p++){var b=t.cloneNode(!0),y=n[o]+"."+p;n[s]=y,a[s]=p,b.removeAttribute("bp-for"),b.setAttribute("bp-for-rendered-id",l),this.bindForItemsRecursion(b,n,a,y,p,!0,function(t){v.appendChild(t)})}f.replaceChild(v,t),this.register(this.$dataList,this.$dataListPure,h.path,function(n,i){for(var a=document.createDocumentFragment(),r=0;r<i.length;r++){var c=t.cloneNode(!0),h=u[o]+"."+r;u[s]=h,d[s]=r,c.removeAttribute("bp-for"),c.setAttribute("bp-for-rendered-id",l),e.bindForItemsRecursion(c,u,d,h,r,!0,function(t){a.appendChild(t)})}for(var v=f.querySelectorAll("[bp-for-rendered-id='"+l+"']"),p=0;p<v.length;p++)0===p?f.replaceChild(a,v.item(p)):v.item(p).remove()})}},{key:"bindForItemsRecursion",value:function(t,e,n,a,r){for(var o=this,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=!!i.isHTMLCollection(t),u=function(s){var l=c?t[s]:t,u=l.childNodes;if(u.forEach(function(t,a){t.nodeType===Node.TEXT_NODE&&!function(){var a=t.nodeValue,r=t.nodeValue,s=r.match(/{{.*?}}/gi),c={};if(i.isArray(s)&&s.length>0){s.forEach(function(t){var i=t.slice(2,-2).trim(),a=i;/^@/gi.test(i)&&(a=/\[\[index\]\]/gi.test(i)?"@{"+n[i.match(/^(.*)\[\[index\]\]$/)[1]]+"}":i.replace(/^@[a-z0-9A-Z_]*/,e[i.split(".")[0]])),c[t]="{{ "+a+" }}"});for(var u in c)r=a.replace(u,c[u])}t.nodeValue=r,o.bindMoustache(l,t)}()}),!l.hasAttributes()&&c)return l.children.length>0&&o.bindForItemsRecursion(l.children,e,n,a,r),"continue";for(var d=l.attributes,h=[],f=0;f<d.length;f++){var v=d.item(f);if(h.push(v.name),/bp-event:/gi.test(v.name)){var p=v.name.split(":")[1],b=v.value;/^@:/gi.test(b)?o.bindEvent(l,b.split(":")[1],p,o.$dataList,{index:r}):o.bindEvent(l,b,p,o.$dataList,{})}if(/bp-bind:/gi.test(v.name)){var y=v.name.split(":")[1],g=v.value;/^@/gi.test(g)&&(g=g.replace(/^@[a-z0-9A-Z_]*/,e[g.split(".")[0]])),o.bindBind(l,g,y)}}if(h.includes("bp-for"))return o.bindFor(l,e,n),"continue";if(h.includes("bp-class")){var m=l.getAttribute("bp-class"),$=m;/^@/gi.test(m)&&($=m.replace(/^@[a-z0-9A-Z_]*/,e[m.split(".")[0]])),$!==m&&l.setAttribute("bp-class",$),o.bindClass(l)}if(h.includes("bp-model")){var P=l.getAttribute("bp-model"),A=P;/^@/gi.test(P)&&(A=/\[\[index\]\]/gi.test(P)?"@{"+n[P.match(/^(.*)\[\[index\]\]$/)[1]]+"}":/@{\d+}/gi.test(P)?P:P.replace(/^@[a-z0-9A-Z_]*/,e[P.split(".")[0]])),A!==P&&l.setAttribute("bp-model",A),o.bindModel(l)}if(h.includes("bp-show")){var L=l.getAttribute("bp-show"),w=L;/^@/gi.test(L)&&(w=L.replace(/^@[a-z0-9A-Z_]*/,e[L.split(".")[0]])),w!==L&&l.setAttribute("bp-show",w),o.bindShow(l)}l.children.length>0&&o.bindForItemsRecursion(l.children,e,n,a,r)},d=0;d<(c?t.length:1);d++){u(d)}s&&l&&l.call(this,t)}},{key:"observePath",value:function(t,e,n,a){var r=this;i.isArray(n)&&!function(){var i=t,o=void 0;n.forEach(function(t,e){/^\d+$/.test(t)&&(t=parseInt(t)),e<n.length-1?i=i[t]:o=t}),e=n.join("."),r.observeKey(i,e,o,a)}()}},{key:"observeKey",value:function(t,e,n){var a=this,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];i.isArray(n)?this.observePath(t,e,n,r):!function(){var o=t[n],s=e;i.isObject(o)?(Object.defineProperty(t,n,{get:function(){return o},set:function(t){t!==o&&(r&&r.forEach(function(e){e.call(a,o,t)}),o=t,i.renderObjectValueByPath(a.$dataListPure,s,t))},enumerable:!0,configurable:!0}),Object.keys(o).forEach(function(t){a.observeKey(o,s+"."+t,t,r)})):i.isArray(o)?(Object.defineProperty(t,n,{get:function(){return o},set:function(t){t!==o&&(r&&r.forEach(function(e){e.call(a,o,t)}),o=t,i.renderObjectValueByPath(a.$dataListPure,s,t))},enumerable:!0,configurable:!0}),a.observeArray(o,s,r)):Object.defineProperty(t,n,{get:function(){return o},set:function(t){t!==o&&(r&&r.forEach(function(e){e.call(a,o,t)}),o=t,i.renderObjectValueByPath(a.$dataListPure,s,t))},enumerable:!0,configurable:!0})}()}},{key:"observeArray",value:function(t,e){var n=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=["copyWithin","fill","pop","push","reverse","shift","sort","splice","unshift"],o=Array.prototype,s=Object.create(o),l=e;r.forEach(function(e){Object.defineProperty(s,e,{enumerable:!0,configurable:!0,writable:!0,value:function(){for(var r,s=arguments.length,c=Array(s),u=0;u<s;u++)c[u]=arguments[u];var d=t.slice(),h=(r=o[e]).call.apply(r,[t].concat(c)),f=t;return i.renderObjectValueByPath(n.$dataListPure,l,f),a&&a.forEach(function(t){t.call(n,d,f)}),h}})}),t.__proto__=s}},{key:"register",value:function t(e,n,i,a){var t=this.$registers.find(function(t){if(Object.is(t.obj,e)&&(t.key===i||t.key.toString()===i.toString()))return t});t?t.fns.push(a):this.$registers.push({obj:e,rootPath:[],key:i,fns:[a]})}},{key:"attach",value:function(){var t=this;this.$registers.forEach(function(e){t.observeKey(e.obj,e.rootPath,e.key,e.fns)})}}],[{key:"isHTMLCollection",value:function(t){return"[object HTMLCollection]"===Object.prototype.toString.call(t)}},{key:"isArray",value:function(t){return Array.isArray(t)||"[object Array]"===Object.prototype.toString.call(t)}},{key:"toArray",value:function(t){return Array.prototype.slice.call(t)}},{key:"isObject",value:function(t){return"[object Object]"===Object.prototype.toString.call(t)}},{key:"renderObjectValueByPath",value:function(t,e,n){var a=e.split(".");if("undefined"==typeof i.parseData(e,t).data&&i.throwError('Find an invalid watcher path when initializing Ballpen.js -> "'+e+'"',"Please make sure the watcher path you set is exist and valid."),1===a.length)t[a[0]]=n;else for(var r=0;r<a.length-1;r++)t=t[a[r]],t||i.throwError('Find an invalid watcher path when initializing Ballpen.js -> "'+e+'"',"Please make sure the watcher path you set is exist and valid."),r===a.length-2&&(t[a[a.length-1]]=n)}},{key:"parseData",value:function(t,e){var n=t.split("."),i=e,a=[];return n.forEach(function(t,n){0===n?(i=e[t],a.push(t)):(i=i[t],a.push(t))}),{path:a,data:i}}},{key:"ignoreInnerDirectives",value:function(t,e,n){for(var i=arguments.length,a=Array(i>3?i-3:0),r=3;r<i;r++)a[r-3]=arguments[r];var o=this;e.forEach(function(e){e.test(t)&&n&&n.call.apply(n,[o].concat(a))}),/^@/gi.test(t)||n&&n.call.apply(n,[this].concat(a))}},{key:"clone",value:function(t){var n=void 0;if(null===t||"object"!==("undefined"==typeof t?"undefined":e(t)))return t;if(t instanceof Date)return n=new Date,n.setTime(t.getTime()),n;if(t instanceof Array){n=[];for(var a=0,r=t.length;a<r;a++)n[a]=i.clone(t[a]);return n}if(t instanceof Object){n={};for(var o in t)t.hasOwnProperty(o)&&(n[o]=i.clone(t[o]));return n}i.throwError("Internal error, unable to copy object, type is not supported.","Please contact the author to fix this issue.")}},{key:"wrapAbsPath",value:function(t,e){return(i.isArray(t)&&t.length>0?t.join(".")+".":t.toString().length>0?t.toString()+".":"")+(i.isArray(e)&&e.length>0?e.join("."):e.toString().length>0?e.toString():"")}},{key:"throwError",value:function(t,e){var n=new Error("[Ballpen Parser Error] \n\n [Message] \n\n - "+t+" \n\n [Description] \n\n - "+e+" \n");throw n.name="BallpenError",n}},{key:"randomSequence",value:function(t){for(var e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],n="",i=0;i<t;i++){var a=Math.ceil(35*Math.random());n+=e[a]}return n}}]),i}();return i});
//# sourceMappingURL=ballpen.min.js.map
