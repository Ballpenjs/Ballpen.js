!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Ballpen=e()}(this,function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),n=function(){function n(e,i){t(this,n),this.init(e,i),this.scan(this.el)}return i(n,[{key:"init",value:function(t,e){var i=this;if(this.el=document.querySelector(t),this.el.style.display="none",!this.el)throw new Error("[Ballpen] Invalid root element!");if(this.dataModel=e,e.event&&(this.eventList={},this.initEventList(e.event)),e.data&&(this.dataListPure=e.data,this.dataList=n.clone(e.data),this.modelList={}),e.watchers){this.watchersHook=new Map;var a=e.watchers;for(var r in a){var s=r,o=a[r].handler;this.watchersHook.set(s,o)}this.watchersHook.forEach(function(t,e){n.renderObjectValueByPath(i.dataList,e,i.setProxy(n.parseData(e,i.dataList).data,e,t,t))})}this.registers=[],this.removedChildNodes=[]}},{key:"setProxy",value:function(t,e){var i=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s={get:function(t,a){return r&&r.call(i,n.parseData(e,i.dataListPure).data,n.parseData(e,i.dataList).data),t[a]},set:function(t,r,s,o){if(/^\$/gi.test(r))var l=r.substring(1);else var l=r;return t[l]=s,l===r&&a&&a.call(i,n.parseData(e,i.dataListPure).data,n.parseData(e,i.dataList).data),!0},defineProperty:function(t,e,i){return Reflect.defineProperty(t,e,i)}};return new Proxy(t,s)}},{key:"initEventList",value:function(t){if(t){var e=t;for(var i in e)this.eventList[i]={},this.eventList[i].type="",this.eventList[i].fn=e[i]}}},{key:"scan",value:function(t){for(var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=0;i<t.children.length;i++){var n=t.children[i];t.innerHTML;this.bind(n),n.children.length>0&&this.scan(n,!1)}e&&(this.update(),this.attach(),this.el.style.removeProperty?this.el.style.removeProperty("display"):this.el.style.removeAttribute("display"))}},{key:"update",value:function(){this.removedChildNodes.forEach(function(t){t.remove()})}},{key:"bind",value:function(t){if(t.hasAttributes())for(var e=t.attributes,i=0;i<e.length;i++){var n=e.item(i);if("bp-model"===n.name&&this.bindModel(t),"bp-class"===n.name&&this.bindClass(t),/bp-event:/gi.test(n.name)){var a=n.name.split(":")[1],r=n.value;this.bindEvent(t,r,a,this.dataList)}if(/bp-bind:/gi.test(n.name)){var s=n.name.split(":")[1],o=n.value;this.bindBind(t,o,s)}"bp-for"===n.name&&this.bindFor(t),"bp-show"===n.name&&this.bindShow(t)}}},{key:"bindShow",value:function(t){var e=this,i=t.getAttribute("bp-show");n.ignoreInnerDirectives(i,[],function(t){var a=n.parseData(i,e.dataList),r=t.style;a.data?r.removeProperty?r.removeProperty("display"):r.removeAttribute("display"):r.display="none",e.register(e.dataList,e.dataListPure,a.path,function(t,e){e?r.removeProperty?r.removeProperty("display"):r.removeAttribute("display"):r.display="none"})},t)}},{key:"bindModel",value:function(t){var e=this,i=t.getAttribute("bp-model");n.ignoreInnerDirectives(i,[/^@{([\d]+)}$/gi],function(t){if(/^@{([\d]+)}$/gi.test(i)){var a=i.match(/^@{([\d]+)}$/)[1];"INPUT"===t.tagName?t.value=a:t.innerText=a}else{var r=n.parseData(i,e.dataList);"INPUT"===t.tagName?t.value=r.data:t.innerText=r.data,e.register(e.dataList,e.dataListPure,r.path,function(e,i){"INPUT"===t.tagName?t.value=i:t.innerText=i})}},t)}},{key:"bindClass",value:function(t){var e=this,i=t.getAttribute("bp-class");n.ignoreInnerDirectives(i,[],function(t){var a=n.parseData(i,e.dataList);t.classList.contains(a.data)||t.classList.add(a.data),e.register(e.dataList,e.dataListPure,a.path,function(e,i){t.classList.contains(i)||t.classList.add(i)})},t)}},{key:"bindEvent",value:function(t,e,i,a){var r=this,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};n.ignoreInnerDirectives(e,[],function(t,e,i,n){r.eventList[e].type=i,t.addEventListener(i,function(){r.eventList[e].fn.call(r.dataList,t,n,s)})},t,e,i,a,s)}},{key:"bindBind",value:function(t,e,i){var a=this;n.ignoreInnerDirectives(e,[],function(t,e,i){var r=n.parseData(e,a.dataList);t.setAttribute(i,r.data),a.register(a.dataList,a.dataListPure,r.path,function(e,n){t.setAttribute(i,n)})},t,e,i)}},{key:"bindFor",value:function(t){for(var e=this,i=t.getAttribute("bp-for"),a=n.parseData(i,this.dataList),r=t.parentNode,s=document.createDocumentFragment(),o=0;o<a.data.length;o++){var l=t.cloneNode(!0),u=i+"."+o;l.removeAttribute("bp-for"),s.appendChild(this.bindForItems(l,u,o))}r.appendChild(s),this.register(this.dataList,this.dataListPure,a.path,function(n,a){for(var s=document.createDocumentFragment(),o=0;o<a.length;o++){var l=t.cloneNode(!0),u=i+"."+o;s.appendChild(e.bindForItems(l,u,o))}for(;r.firstChild;)r.removeChild(r.firstChild);r.appendChild(s)}),this.removedChildNodes.push(t)}},{key:"bindForItemsRecursion",value:function(t,e,i){for(var a=!!n.isHTMLCollection(t),r=0;r<(a?t.length:1);r++){var s=a?t[r]:t;if(s.hasAttributes()||!a){for(var o=s.attributes,l=0;l<o.length;l++){var u=o.item(l);if("bp-class"===u.name){var c=s.getAttribute("bp-class"),d=c;if(/^@\./gi.test(c)){var f=c.split(".")[1];d=e+("."+f)}else/^@$/gi.test(c)&&(d=e);d!==c&&s.setAttribute("bp-class",d),this.bindClass(s)}if(/bp-event:/gi.test(u.name)){var h=u.name.split(":")[1],v=u.value;/^@:/gi.test(v)&&this.bindEvent(s,v.split(":")[1],h,this.dataList,{index:i})}if("bp-model"===u.name){var p=s.getAttribute("bp-model"),b=p;if(/^@\./gi.test(p)){var y=p.split(".")[1];b=e+("."+y)}else/^@$/gi.test(p)?b=e:/^@{index}$/gi.test(p)&&(b="@{"+i+"}");b!==p&&s.setAttribute("bp-model",b),this.bindModel(s)}if("bp-show"===u.name){var g=s.getAttribute("bp-show"),m=g;if(/^@\./gi.test(g)){var L=g.split(".")[1];m=e+("."+L)}else/^@$/gi.test(g)&&(m=e);m!==g&&s.setAttribute("bp-show",m),this.bindShow(s)}}s.children.length>0&&this.bindForItemsRecursion(s.children,e,i)}}}},{key:"bindForItems",value:function(t,e,i){return this.bindForItemsRecursion(t,e,i),t}},{key:"observePath",value:function(t,e,i,a){var r=this;n.isArray(i)&&!function(){var n=t,s=void 0;i.forEach(function(t,e){/^\d+$/.test(t)&&(t=parseInt(t)),e<i.length-1?n=n[t]:s=t}),e=i.join("."),r.observeKey(n,e,s,a)}()}},{key:"observeKey",value:function(t,e,i){var a=this,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];n.isArray(i)?this.observePath(t,e,i,r):!function(){var s=t[i],o=e;n.isObject(s)?(Object.defineProperty(t,i,{get:function(){return s},set:function(t){t!==s&&(r&&r.forEach(function(e){e.call(a,s,t)}),s=t,n.renderObjectValueByPath(a.dataListPure,o,t))},enumerable:!0,configurable:!0}),Object.keys(s).forEach(function(t){a.observeKey(s,o+"."+t,t,r)})):n.isArray(s)?(Object.defineProperty(t,i,{get:function(){return s},set:function(t){t!==s&&(r&&r.forEach(function(e){e.call(a,s,t)}),s=t,n.renderObjectValueByPath(a.dataListPure,o,t))},enumerable:!0,configurable:!0}),a.observeArray(s,o,r)):Object.defineProperty(t,i,{get:function(){return s},set:function(t){t!==s&&(r&&r.forEach(function(e){e.call(a,s,t)}),s=t,n.renderObjectValueByPath(a.dataListPure,o,t))},enumerable:!0,configurable:!0})}()}},{key:"observeArray",value:function(t,e){var i=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=["copyWithin","fill","pop","push","reverse","shift","sort","splice","unshift"],s=Array.prototype,o=Object.create(s),l=e;r.forEach(function(e){Object.defineProperty(o,e,{enumerable:!0,configurable:!0,writable:!0,value:function(){for(var r,o=arguments.length,u=Array(o),c=0;c<o;c++)u[c]=arguments[c];var d=t.slice(),f=(r=s[e]).call.apply(r,[t].concat(u)),h=t;return n.renderObjectValueByPath(i.dataListPure,l,h),a&&a.forEach(function(t){t.call(i,d,h)}),f}})}),t.__proto__=o}},{key:"register",value:function t(e,i,n,a){var t=this.registers.find(function(t){if(Object.is(t.obj,e)&&(t.key===n||t.key.toString()===n.toString()))return t});t?t.fns.push(a):this.registers.push({obj:e,rootPath:[],key:n,fns:[a]})}},{key:"attach",value:function(){var t=this;this.registers.forEach(function(e){t.observeKey(e.obj,e.rootPath,e.key,e.fns)})}}],[{key:"isHTMLCollection",value:function(t){return"[object HTMLCollection]"===Object.prototype.toString.call(t)}},{key:"isArray",value:function(t){return Array.isArray(t)||"[object Array]"===Object.prototype.toString.call(t)}},{key:"isObject",value:function(t){return"[object Object]"===Object.prototype.toString.call(t)}},{key:"renderObjectValueByPath",value:function(t,e,i){var a=e.split(".");if("undefined"==typeof n.parseData(e,t).data)throw new Error('[Ballpen] "'+e+'" is an invalid watch path.');if(1===a.length)t[a[0]]=i;else for(var r=0;r<a.length-1;r++){if(t=t[a[r]],!t)throw new Error('[Ballpen] "'+e+'" is an invalid watch path.');r===a.length-2&&(t[a[a.length-1]]=i)}}},{key:"parseData",value:function(t,e){var i=t.split("."),n=e,a=[];return i.forEach(function(t,i){0===i?(n=e[t],a.push(t)):(n=n[t],a.push(t))}),{path:a,data:n}}},{key:"ignoreInnerDirectives",value:function(t,e,i){for(var n=arguments.length,a=Array(n>3?n-3:0),r=3;r<n;r++)a[r-3]=arguments[r];var s=this;e.forEach(function(e){e.test(t)&&i&&i.call.apply(i,[s].concat(a))}),/^@/gi.test(t)||i&&i.call.apply(i,[this].concat(a))}},{key:"clone",value:function(t){var i=void 0;if(null===t||"object"!==("undefined"==typeof t?"undefined":e(t)))return t;if(t instanceof Date)return i=new Date,i.setTime(t.getTime()),i;if(t instanceof Array){i=[];for(var a=0,r=t.length;a<r;a++)i[a]=n.clone(t[a]);return i}if(t instanceof Object){i={};for(var s in t)t.hasOwnProperty(s)&&(i[s]=n.clone(t[s]));return i}throw new Error("[Ballpen] Unable to copy object, type is not supported.")}}]),n}();return n});
//# sourceMappingURL=ballpen.min.js.map
