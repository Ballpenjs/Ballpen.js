!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Ballpen=t()}(this,function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),i=function(){function i(t,n){e(this,i),this.init(t,n),this.scan(this.$el)}return n(i,[{key:"init",value:function(e,t){var n=this;if(this.$el=document.querySelector(e),this.$el||i.throwError('Find an invalid root element when initializing Ballpen.js -> "'+e+'"','Well, you should set a valid root element for Ballpen.js first constructor parameter, eg: "#app", "#container".'),t.events&&(this.$eventList={},this.initEventList(t.events)),t.data&&(this.$dataListPure=t.data,this.$dataList=i.clone(t.data)),t.watchers){this.watchersHook=new Map;var r=t.watchers;for(var a in r){var o=a,s=r[a].handler;this.watchersHook.set(o,s)}this.watchersHook.forEach(function(e,t){i.renderObjectValueByPath(n.$dataList,t,n.setProxy(i.parseData(t,n.$dataList).data,t,e,e))})}this.$registers=[]}},{key:"setProxy",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o={get:function(e,r){return a&&a.call(n,i.parseData(t,n.$dataListPure).data,i.parseData(t,n.$dataList).data),e[r]},set:function(e,a,o,s){var l=void 0;return l=/^\$/gi.test(a)?a.substring(1):a,e[l]=o,l===a&&r&&r.call(n,i.parseData(t,n.$dataListPure).data,i.parseData(t,n.$dataList).data),!0},defineProperty:function(e,t,n){return Reflect.defineProperty(e,t,n)}};return new Proxy(e,o)}},{key:"initEventList",value:function(e){if(e){var t=e;for(var n in t)this.$eventList[n]={},this.$eventList[n].type="",this.$eventList[n].fn=t[n]}}},{key:"scan",value:function(e){for(var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=function(n){var i=e.children[n];if(i.hasAttributes()){for(var r=i.attributes,a=[],o=0;o<r.length;o++){var s=r.item(o);if(a.push(s.name),/bp-event:/gi.test(s.name)){var l=s.name.split(":")[1],c=s.value;t.bindEvent(i,c,l,t.$dataList)}if(/bp-bind:/gi.test(s.name)){var u=s.name.split(":")[1],d=s.value;t.bindBind(i,d,u)}}if(a.includes("bp-pre"))return"continue";if(a.includes("bp-for"))return t.bindFor(i),"continue";a.includes("bp-model")&&t.bindModel(i),a.includes("bp-class")&&t.bindClass(i),a.includes("bp-show")&&t.bindShow(i)}var h=i.childNodes;h.forEach(function(e,n){e.nodeType===Node.TEXT_NODE&&t.bindMoustache(i,e)}),i.children.length>0&&t.scan(i,!1)},r=0;r<e.children.length;r++){i(r)}n&&(this.attach(),this.$el.removeAttribute("bp-shade"))}},{key:"bindShow",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=i.wrapAbsPath(n,e.getAttribute("bp-show"));i.ignoreInnerDirectives(r,[],function(e){var n=i.parseData(r,t.$dataList),a=e.style;n.data?a.removeProperty?a.removeProperty("display"):a.removeAttribute("display"):a.display="none",t.register(t.$dataList,t.$dataListPure,n.path,function(e,t){t?a.removeProperty?a.removeProperty("display"):a.removeAttribute("display"):a.display="none"})},e)}},{key:"bindModel",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=i.wrapAbsPath(n,e.getAttribute("bp-model"));i.ignoreInnerDirectives(r,[/^@{([\d]+)}$/gi],function(e){if(/^@{([\d]+)}$/gi.test(r)){var n=r.match(/^@{([\d]+)}$/)[1];"INPUT"===e.tagName?e.value=n:e.innerText=n}else{var a=i.parseData(r,t.$dataList);"INPUT"===e.tagName?e.value=a.data:e.innerText=a.data,t.register(t.$dataList,t.$dataListPure,a.path,function(t,n){"INPUT"===e.tagName?e.value=n:e.innerText=n})}},e)}},{key:"bindMoustache",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=t.nodeValue,o=t.nodeValue,s=o.match(/{{.*?}}/gi),l={};if(i.isArray(s)&&s.length>0){s.forEach(function(e){var s=e.slice(2,-2).trim();/^@{([\d]+)}$/gi.test(s)?l[e]=s.match(/^@{([\d]+)}$/)[1]:!function(){var c=i.parseData(i.wrapAbsPath(r,s),n.$dataList);l[e]=c.data,n.register(n.$dataList,n.$dataListPure,c.path,function(e,n){l["{{ "+c.path.join(".")+" }}"]=n;for(var i in l)o=a.replace(i,l[i]);t.nodeValue=o})}()});for(var c in l)o=a.replace(c,l[c])}t.nodeValue=o}},{key:"bindClass",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=i.wrapAbsPath(n,e.getAttribute("bp-class"));i.ignoreInnerDirectives(r,[],function(e){var n=i.parseData(r,t.$dataList);e.classList.contains(n.data)||e.classList.add(n.data),t.register(t.$dataList,t.$dataListPure,n.path,function(t,n){e.classList.remove(t),e.classList.contains(n)||e.classList.add(n)})},e)}},{key:"bindEvent",value:function(e,t,n,r){var a=this,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};i.ignoreInnerDirectives(t,[],function(e,t,n,i){a.$eventList[t].type=n,e.addEventListener(n,function(){a.$eventList[t].fn.call(a.$dataList,e,i,o)})},e,t,n,r,o)}},{key:"bindBind",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];i.ignoreInnerDirectives(t,[],function(e,t,n){var o=i.wrapAbsPath(a,t),s=i.parseData(o,r.$dataList);e.setAttribute(n,s.data),r.register(r.$dataList,r.$dataListPure,s.path,function(t,i){e.setAttribute(n,i)})},e,t,n)}},{key:"bindFor",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=e.getAttribute("bp-for").split(/\s+in\s+/),o=a[1],s=a[0],l=i.randomSequence(12);if(/^@/gi.test(s)||i.throwError('Invalid alias name when initializing a "bp-for" condition -> "'+s+'".','Please make sure the alias name is start with a "@" symbol.'),/\./gi.test(o)){var c=o.split(".");n[o]=n[c[0]]+"."+c[1]}else n[o]=o;for(var u=i.clone(n),d=i.clone(r),h=i.parseData(n[o],this.$dataList),f=e.parentNode,v=document.createDocumentFragment(),p=0;p<h.data.length;p++){var b=e.cloneNode(!0),y=n[o]+"."+p;n[s]=y,r[s]=p,b.removeAttribute("bp-for"),b.setAttribute("bp-for-rendered-id",l),this.bindForItemsRecursion(b,n,r,y,p,!0,function(e){v.appendChild(e)})}f.replaceChild(v,e),this.register(this.$dataList,this.$dataListPure,h.path,function(n,i){for(var r=document.createDocumentFragment(),a=0;a<i.length;a++){var c=e.cloneNode(!0),h=u[o]+"."+a;u[s]=h,d[s]=a,c.removeAttribute("bp-for"),c.setAttribute("bp-for-rendered-id",l),t.bindForItemsRecursion(c,u,d,h,a,!0,function(e){r.appendChild(e)})}for(var v=f.querySelectorAll("[bp-for-rendered-id='"+l+"']"),p=0;p<v.length;p++)0===p?f.replaceChild(r,v.item(p)):v.item(p).remove()})}},{key:"bindForItemsRecursion",value:function(e,t,n,r,a){for(var o=this,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=!!i.isHTMLCollection(e),u=function(s){var l=c?e[s]:e,u=l.childNodes;if(u.forEach(function(e,r){e.nodeType===Node.TEXT_NODE&&!function(){var r=e.nodeValue,a=e.nodeValue,s=a.match(/{{.*?}}/gi),c={};if(i.isArray(s)&&s.length>0){s.forEach(function(e){var i=e.slice(2,-2).trim(),r=i;/^@/gi.test(i)&&(r=/\[\[index\]\]/gi.test(i)?"@{"+n[i.match(/^(.*)\[\[index\]\]$/)[1]]+"}":i.replace(/^@[a-z0-9A-Z_]*/,t[i.split(".")[0]])),c[e]="{{ "+r+" }}"});for(var u in c)a=r.replace(u,c[u])}e.nodeValue=a,o.bindMoustache(l,e)}()}),!l.hasAttributes()&&c)return l.children.length>0&&o.bindForItemsRecursion(l.children,t,n,r,a),"continue";for(var d=l.attributes,h=[],f=0;f<d.length;f++){var v=d.item(f);if(h.push(v.name),/bp-event:/gi.test(v.name)){var p=v.name.split(":")[1],b=v.value;/^@:/gi.test(b)?o.bindEvent(l,b.split(":")[1],p,o.$dataList,{index:a}):o.bindEvent(l,b,p,o.$dataList,{})}if(/bp-bind:/gi.test(v.name)){var y=v.name.split(":")[1],g=v.value;/^@/gi.test(g)&&(g=g.replace(/^@[a-z0-9A-Z_]*/,t[g.split(".")[0]])),o.bindBind(l,g,y)}}if(h.includes("bp-for"))return o.bindFor(l,t,n),"continue";if(h.includes("bp-class")){var m=l.getAttribute("bp-class"),$=m;/^@/gi.test(m)&&($=m.replace(/^@[a-z0-9A-Z_]*/,t[m.split(".")[0]])),$!==m&&l.setAttribute("bp-class",$),o.bindClass(l)}if(h.includes("bp-model")){var A=l.getAttribute("bp-model"),P=A;/^@/gi.test(A)&&(P=/\[\[index\]\]/gi.test(A)?"@{"+n[A.match(/^(.*)\[\[index\]\]$/)[1]]+"}":/@{\d+}/gi.test(A)?A:A.replace(/^@[a-z0-9A-Z_]*/,t[A.split(".")[0]])),P!==A&&l.setAttribute("bp-model",P),o.bindModel(l)}if(h.includes("bp-show")){var L=l.getAttribute("bp-show"),w=L;/^@/gi.test(L)&&(w=L.replace(/^@[a-z0-9A-Z_]*/,t[L.split(".")[0]])),w!==L&&l.setAttribute("bp-show",w),o.bindShow(l)}l.children.length>0&&o.bindForItemsRecursion(l.children,t,n,r,a)},d=0;d<(c?e.length:1);d++){u(d)}s&&l&&l.call(this,e)}},{key:"observePath",value:function(e,t,n,r){var a=this;i.isArray(n)&&!function(){var i=e,o=void 0;n.forEach(function(e,t){/^\d+$/.test(e)&&(e=parseInt(e)),t<n.length-1?i=i[e]:o=e}),t=n.join("."),a.observeKey(i,t,o,r)}()}},{key:"observeKey",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];i.isArray(n)?this.observePath(e,t,n,a):!function(){var o=e[n],s=t;i.isObject(o)?(Object.defineProperty(e,n,{get:function(){return o},set:function(e){e!==o&&(a&&a.forEach(function(t){t.call(r,o,e)}),o=e,i.renderObjectValueByPath(r.$dataListPure,s,e))},enumerable:!0,configurable:!0}),Object.keys(o).forEach(function(e){r.observeKey(o,s+"."+e,e,a)})):i.isArray(o)?(Object.defineProperty(e,n,{get:function(){return o},set:function(e){e!==o&&(a&&a.forEach(function(t){t.call(r,o,e)}),o=e,i.renderObjectValueByPath(r.$dataListPure,s,e))},enumerable:!0,configurable:!0}),r.observeArray(o,s,a)):Object.defineProperty(e,n,{get:function(){return o},set:function(e){e!==o&&(a&&a.forEach(function(t){t.call(r,o,e)}),o=e,i.renderObjectValueByPath(r.$dataListPure,s,e))},enumerable:!0,configurable:!0})}()}},{key:"observeArray",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=["copyWithin","fill","pop","push","reverse","shift","sort","splice","unshift"],o=Array.prototype,s=Object.create(o),l=t;a.forEach(function(t){Object.defineProperty(s,t,{enumerable:!0,configurable:!0,writable:!0,value:function(){for(var a,s=arguments.length,c=Array(s),u=0;u<s;u++)c[u]=arguments[u];var d=e.slice(),h=(a=o[t]).call.apply(a,[e].concat(c)),f=e;return i.renderObjectValueByPath(n.$dataListPure,l,f),r&&r.forEach(function(e){e.call(n,d,f)}),h}})}),e.__proto__=s}},{key:"register",value:function e(t,n,i,r){var e=this.$registers.find(function(e){if(Object.is(e.obj,t)&&(e.key===i||e.key.toString()===i.toString()))return e});e?e.fns.push(r):this.$registers.push({obj:t,rootPath:[],key:i,fns:[r]})}},{key:"attach",value:function(){var e=this;this.$registers.forEach(function(t){e.observeKey(t.obj,t.rootPath,t.key,t.fns)})}}],[{key:"isHTMLCollection",value:function(e){return"[object HTMLCollection]"===Object.prototype.toString.call(e)}},{key:"isArray",value:function(e){return Array.isArray(e)||"[object Array]"===Object.prototype.toString.call(e)}},{key:"toArray",value:function(e){return Array.prototype.slice.call(e)}},{key:"isObject",value:function(e){return"[object Object]"===Object.prototype.toString.call(e)}},{key:"renderObjectValueByPath",value:function(e,t,n){var r=t.split(".");if("undefined"==typeof i.parseData(t,e).data&&i.throwError('Find an invalid watcher path when initializing Ballpen.js -> "'+t+'"',"Please make sure the watcher path you set is exist and valid."),1===r.length)e[r[0]]=n;else for(var a=0;a<r.length-1;a++)e=e[r[a]],e||i.throwError('Find an invalid watcher path when initializing Ballpen.js -> "'+t+'"',"Please make sure the watcher path you set is exist and valid."),a===r.length-2&&(e[r[r.length-1]]=n)}},{key:"parseData",value:function(e,t){var n=e.split("."),i=t,r=[];return n.forEach(function(e,n){0===n?(i=t[e],r.push(e)):(i=i[e],r.push(e))}),{path:r,data:i}}},{key:"ignoreInnerDirectives",value:function(e,t,n){for(var i=arguments.length,r=Array(i>3?i-3:0),a=3;a<i;a++)r[a-3]=arguments[a];var o=this;t.forEach(function(t){t.test(e)&&n&&n.call.apply(n,[o].concat(r))}),/^@/gi.test(e)||n&&n.call.apply(n,[this].concat(r))}},{key:"clone",value:function(e){var n=void 0;if(null===e||"object"!==("undefined"==typeof e?"undefined":t(e)))return e;if(e instanceof Date)return n=new Date,n.setTime(e.getTime()),n;if(e instanceof Array){n=[];for(var r=0,a=e.length;r<a;r++)n[r]=i.clone(e[r]);return n}if(e instanceof Object){n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]=i.clone(e[o]));return n}i.throwError("Internal error, unable to copy object, type is not supported.","Please contact the author to fix this issue.")}},{key:"wrapAbsPath",value:function(e,t){return(i.isArray(e)&&e.length>0?e.join(".")+".":e.toString().length>0?e.toString()+".":"")+(i.isArray(t)&&t.length>0?t.join("."):t.toString().length>0?t.toString():"")}},{key:"throwError",value:function(e,t){var n=new Error("[Ballpen Parser Error] \n\n [Message] \n\n - "+e+" \n\n [Description] \n\n - "+t+" \n");throw n.name="BallpenError",n}},{key:"randomSequence",value:function(e){for(var t=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],n="",i=0;i<e;i++){var r=Math.ceil(35*Math.random());n+=t[r]}return n}}]),i}();return i});
//# sourceMappingURL=ballpen.min.js.map
