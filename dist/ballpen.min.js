!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Ballpen=t()}(this,function(){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),r=function(){function e(){t(this,e)}return n(e,null,[{key:"filterParams",value:function(t){var n=[],r=t.match(/\(([a-zA-Z0-9_$]*?)\)/i)[1];if(r){var i=t.match(new RegExp(r+"([\"[a-zA-Z0-9_$]+\"]|['[a-zA-Z0-9_$]+']|[[0-9]+]|.[a-zA-Z0-9_$]+)*","ig"));if(i.length>0){var a=new Set;return i.forEach(function(t,n){n>0&&a.add(e._parseObjectToPath(t))}),Array.from(a)}}return n}},{key:"_parseObjectToPath",value:function(e){return e.match(new RegExp("[0-9A-Za-z]+","ig")).splice(1).join(".")}}]),e}(),i=function(){function e(){t(this,e)}return n(e,null,[{key:"errorEntity",value:function(e){return{INIT_INVALID_ROOT:{err:'Find an invalid root element when initializing Ballpen.js -> "'+e+'"',desc:'Well, you should set a valid root element for Ballpen.js first constructor parameter, eg: "#app", "#container".'},INVALID_RENDER_PATH:{err:'Find an invalid watcher path when initializing Ballpen.js -> "'+e+'"',desc:"Please make sure the watcher path you set is exist and valid."},BIND_FOR_INVALID_ALIAS:{err:'Invalid alias name when initializing a "bp-for" condition -> "'+e+'".',desc:'Please make sure the alias name is start with a "@" symbol.'},INTERNEL_INVALID_CLONE:{err:"Internal error, unable to copy object, type is not supported.",desc:"Please contact the author to fix this issue."}}}},{key:"throw",value:function(e){var t=e.err,n=e.desc,r=new Error("[Ballpen Parser Error] \n\n [Message] \n\n - "+t+" \n\n [Description] \n\n - "+n+" \n");throw r.name="BallpenError",r}},{key:"trigger",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e.throw(e.errorEntity(n)[t])}}]),e}(),a=function(){function a(){t(this,a)}return n(a,null,[{key:"findReferenceNode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=n;if(a.isObject(e))for(var i in e)(a.isObject(e[i])||a.isArray(e[i]))&&(r+=i+".",t.set(r.slice(0,-1),[]),a.findReferenceNode(e[i],t,r));else a.isArray(e)&&e.forEach(function(e,n){(a.isObject(e)||a.isArray(e))&&(r+=n+".",t.set(r.slice(0,-1),[]),a.findReferenceNode(e,t,r))});return t}},{key:"isHTMLCollection",value:function(e){return"[object HTMLCollection]"===Object.prototype.toString.call(e)}},{key:"isArray",value:function(e){return Array.isArray(e)||"[object Array]"===Object.prototype.toString.call(e)}},{key:"toArray",value:function(e){return Array.prototype.slice.call(e)}},{key:"isObject",value:function(e){return"[object Object]"===Object.prototype.toString.call(e)}},{key:"isNumber",value:function(e){return"[object Number]"===Object.prototype.toString.call(e)}},{key:"isReferenceType",value:function(e){return a.isObject(e)||a.isArray(e)}},{key:"renderObjectValueByPath",value:function(e,t,n){var r=t.split(".");if(void 0===a.parseData(t,e).data&&i.trigger("INVALID_RENDER_PATH",t),1===r.length)e[r[0]]=n;else for(var o=0;o<r.length-1;o++)e=e[r[o]],e||i.trigger("INVALID_RENDER_PATH",t),o===r.length-2&&(e[r[r.length-1]]=n)}},{key:"parseData",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("*"===e.charAt(0)){var r={path:{real:e,base:n._reference[e.substring(1)]},data:n[e.substring(1)]};return r.path.join=function(e){return r.path.real},r}var i=e.split("."),a=t,o=[];return i.forEach(function(e,n){0===n?(a=t[e],o.push(e)):(a=a[e],o.push(e))}),{path:o,data:a}}},{key:"ignoreInnerDirectives",value:function(e,t,n){var r=this;t.forEach(function(t){t.test(e)&&n&&n.call(r)}),/^@/gi.test(e)||n&&n.call(this)}},{key:"clone",value:function(t){var n=void 0;if(null===t||"object"!==(void 0===t?"undefined":e(t)))return t;if(t instanceof Date)return n=new Date,n.setTime(t.getTime()),n;if(t instanceof Array){n=[];for(var r=0,o=t.length;r<o;r++)n[r]=a.clone(t[r]);return n}if(t instanceof Object){n={};for(var s in t)t.hasOwnProperty(s)&&(n[s]=a.clone(t[s]));return n}i.trigger("INTERNEL_INVALID_CLONE")}},{key:"wrapAbsPath",value:function(e,t){return(a.isArray(e)&&e.length>0?e.join(".")+".":e.toString().length>0?e.toString()+".":"")+(a.isArray(t)&&t.length>0?t.join("."):t.toString().length>0?t.toString():"")}},{key:"randomSequence",value:function(e){for(var t=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],n="",r=0;r<e;r++){n+=t[Math.ceil(35*Math.random())]}return n}},{key:"analyzeComputedReference",value:function(e,t){var n=r.filterParams(e),i=[];return n.forEach(function(e,t){i.push(e)}),i}}]),a}(),o=function(){function e(){t(this,e)}return n(e,null,[{key:"observePath",value:function(t,n,r,i,o){if(a.isArray(i)){var s=t,c=void 0;i.forEach(function(e,t){/^\d+$/.test(e)&&(e=parseInt(e)),t<i.length-1?s=s[e]:c=e}),r=i.join("."),e.observeKey(s,n,r,c,o)}}},{key:"observeKey",value:function(t,n,r,i){var o=this,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(a.isArray(i))e.observePath(t,n,r,i,s);else{var c=t._reference&&t._fn,l=t[i],u=r;a.isObject(l)?(Object.defineProperty(t,i,{get:function(){return l},set:function(e){e!==l&&(c||a.renderObjectValueByPath(n,u,e),s&&s.forEach(function(t){t.call(o,l,e)}),l=e)},enumerable:!0,configurable:!0}),Object.keys(l).forEach(function(t){e.observeKey(l,u+"."+t,t,s)})):a.isArray(l)?(Object.defineProperty(t,i,{get:function(){return l},set:function(e){e!==l&&(c||a.renderObjectValueByPath(n,u,e),s&&s.forEach(function(t){t.call(o,l,e)}),l=e)},enumerable:!0,configurable:!0}),e.observeArray(l,n,u,s)):Object.defineProperty(t,i,{get:function(){return l},set:function(e){e!==l&&(c||a.renderObjectValueByPath(n,u,e),s&&s.forEach(function(t){t.call(o,l,e)}),l=e)},enumerable:!0,configurable:!0})}}},{key:"observeArray",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=["copyWithin","fill","pop","push","reverse","shift","sort","splice","unshift"],s=Array.prototype,c=Object.create(s),l=n;o.forEach(function(n){Object.defineProperty(c,n,{enumerable:!0,configurable:!0,writable:!0,value:function(){for(var o,c=arguments.length,u=Array(c),d=0;d<c;d++)u[d]=arguments[d];var f=e.slice(),h=(o=s[n]).call.apply(o,[e].concat(u)),p=e;return a.renderObjectValueByPath(t,l,p),i&&i.forEach(function(e){e.call(r,f,p)}),h}})}),e.__proto__=c}},{key:"register",value:function(e,t,n,r,i,o){var s=this;if(a.isObject(i)){var c=i.real.substring(1),l=e.find(function(e){if(Object.is(e.obj,n)&&(e.key===i.real||e.key.toString()===i.real.toString()))return e});l?l.fns.push(o):e.push({obj:n,path:c.join("."),rootPath:"",key:c,fns:[o]}),i.base.forEach(function(i){var o=e.find(function(e){if(Object.is(e.obj,t)&&(e.key===i||e.key.toString()===i.toString()))return e}),l=function(e,t){t!==e&&(n[c]=n._fn[c].call(s,r))};if(o)o.fns.push(l);else{var u=a.parseData(i,t).path;e.push({obj:t,objPure:r,path:u.join("."),rootPath:"",key:u,fns:[l]})}})}else if(a.isArray(i)){var u=e.find(function(e){if(Object.is(e.obj,t)&&(e.key===i||e.key.toString()===i.toString()))return e});u?u.fns.push(o):e.push({obj:t,objPure:r,path:i.join("."),rootPath:"",key:i,fns:[o]})}}},{key:"attach",value:function(t){t.forEach(function(t){e.observeKey(t.obj,t.objPure,t.rootPath,t.key,t.fns)})}}]),e}(),s=function(){function e(){t(this,e)}return n(e,null,[{key:"setProxy",value:function(e,t,n,r){var i=this,o=a.parseData(e,n).data,s=a.parseData(e,r).data,c={get:function(e,t){return e[t]},set:function(o,c,l,u){if(l!==s[c]){var d=void 0;a.isReferenceType(l)?(s[c]=a.clone(l),d=a.clone(l)):(s[c]=l,d=l),a.renderObjectValueByPath(r,e+"."+c,d),o[c]=l,t.forEach(function(e){var t=e.handler,o=e.root;t&&t.call(i,a.parseData(o,r).data,a.parseData(o,n).data)})}return!0},defineProperty:function(e,t,n){return Reflect.defineProperty(e,t,n)}};return new Proxy(o,c)}}]),e}(),c=function(){function e(){t(this,e)}return n(e,null,[{key:"analyzeDecoratorDependency",value:function(e){var t=e.split("->:");return{decorators:t.slice(1),modelPath:t[0]}}},{key:"analyzeDecorators",value:function(e){return{decorators:e.split("->:").slice(1)}}},{key:"decorate",value:function(e,t,n){var r=this,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=n;if(i){a.clone(n)}return t.decorators.forEach(function(t){o=e[t].call(r,o)}),o}}]),e}(),l=function(){function e(){t(this,e)}return n(e,null,[{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return WebAssembly.compile(e)}).then(function(e){return t.env=t.env||{},t.env.memoryBase=t.env.memoryBase||0,t.env.memory||(t.env.memory=new WebAssembly.Memory({initial:256})),t.env.tableBase=t.env.tableBase||0,t.env.table||(t.env.table=new WebAssembly.Table({initial:0,element:"anyfunc"})),new WebAssembly.Instance(e,t)})}},{key:"loadAll",value:function(e){}}]),e}(),u=function(){function e(){t(this,e)}return n(e,null,[{key:"set",value:function(t){t.registerPlugin=e.registerPlugin,t.$refs={},window.WebAssembly&&t.wasmPath&&(t.wasmCore={},t.wasmCore=l.loadAll(t.wasmPath))}},{key:"registerPlugin",value:function(e,t){Ballpen["$"+e]=t}}]),e}();return function(){function e(n,r){var i=this;t(this,e),this.$dataModel=r,this.$id=this.$dataModel.name?this.$dataModel.name.trim():a.randomSequence(6),this.$dataModel.wasmPath&&(e.wasmPath=this.$dataModel.wasmPath.trim()),u.set(e),e.bus||(e.bus={}),e.bus[this.$id]=this.$dataModel,this.lifecycleHookPoint("beforeRender",this.$dataModel,function(){i.init(n,i.$dataModel),i.scan(i.$el)})}return n(e,[{key:"lifecycleHookPoint",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=t.data;t.lifecycle?t.lifecycle.beforeRender&&"beforeRender"===e?new Promise(function(e,r){return t.lifecycle.beforeRender.call(n,e,r,i)}).then(function(){r&&r.call(n,t)}).catch(function(e){}):t.lifecycle.afterRneder&&"afterRender"===e?t.lifecycle.afterRender.call(this,i):r&&r.call(this,t):r&&r.call(this,t)}},{key:"init",value:function(t,n){var r=this;if(this.$el=document.querySelector(t),this.$el||i.trigger("INIT_INVALID_ROOT",t),n.data&&(this.$dataListPure=n.data,this.data=this.$dataListPure,this.$dataList=a.clone(n.data),e.bus[this.$id]._obs=this.$dataList),n.events&&(this.$eventList={},this.initEventList(n.events)),n.watchers){this.watchersHook=a.findReferenceNode(this.$dataList);var o=n.watchers;for(var c in o)!function(e){var t={root:e,handler:o[e].handler};r.watchersHook.forEach(function(n,r){new RegExp("^"+e,"ig").test(r)&&n.push(t)})}(c);this.watchersHook.forEach(function(e,t){a.renderObjectValueByPath(r.$dataList,t,s.setProxy(t,e,r.$dataList,r.$dataListPure))})}if(n.computed){this.$computedList={};for(var l in n.computed)this.$computedList[l]={},this.$computedList._reference={},this.$computedList._fn={},this.$computedList._reference[l]=a.analyzeComputedReference(n.computed[l].toString(),this.$dataListPure),this.$computedList._fn[l]=n.computed[l],this.$computedList[l]=n.computed[l].call(this,this.$dataListPure)}if(n.decorators){var u=n.decorators;this.$decoratorList={};for(var d in u)this.$decoratorList[d]=u[d]}n.components,this.$registers=[]}},{key:"initEventList",value:function(e){if(e){var t=e;for(var n in t)this.$eventList[n]={},this.$eventList[n].type="",this.$eventList[n].fn=t[n]}}},{key:"scan",value:function(e){for(var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=0;r<e.children.length;r++){(function(n){var r=e.children[n];if(r.hasAttributes()){for(var i=r.attributes,a=[],o=0;o<i.length;o++){var s=i.item(o);a.push(s.name),/bp-event/gi.test(s.name)&&function(){r.removeAttribute(s.name);var e=[],n=s;if(/bp-event:/gi.test(n.name))e.push({_fnType:n.name.split(":")[1],_fnName:n.value});else{n.value.match(/[a-zA-Z]+:[a-zA-Z0-9_$]+/gi).forEach(function(t){e.push({_fnType:t.split(":")[0],_fnName:t.split(":")[1]})})}e.forEach(function(e){var n=e._fnType,i=e._fnName;t.bindEvent(r,i,n,t.$dataList,{})})}(),/bp-bind/gi.test(s.name)&&function(){r.removeAttribute(s.name);var e=[],n=s;if(/bp-bind:/gi.test(n.name))e.push({_bindKey:n.name.split(":")[1],_thisSubModelAbs:n.value});else{n.value.match(/[a-zA-Z0-9_$-]+:[a-zA-Z0-9_$.\->:()]+/gi).forEach(function(t){var n=t.split(/:+?/);e.push({_bindKey:n[0],_thisSubModelAbs:n.slice(1).join(":")})})}e.forEach(function(e){var n=e._bindKey,i=e._thisSubModelAbs;t.bindBind(r,i,n)})}()}if(a.includes("bp-pre"))return t.bindPre(r),"continue";if(a.includes("bp-for"))return t.bindFor(r),"continue";a.includes("bp-model")&&t.bindModel(r),a.includes("bp-class")&&t.bindClass(r),a.includes("bp-show")&&t.bindShow(r),a.includes("bp-ref")&&t.bindRef(r)}r.childNodes.forEach(function(e,n){e.nodeType===Node.TEXT_NODE&&t.bindMoustache(r,e)}),r.children.length>0&&t.scan(r,!1)})(r)}n&&(o.attach(this.$registers),this.$el.removeAttribute("bp-shade"),this.lifecycleHookPoint("afterRender",this.$dataModel))}},{key:"bindRef",value:function(t){var n=t.getAttribute("bp-ref");a.isArray(e.$refs[n])?e.$refs[n].push(t):(e.$refs[n]=[],e.$refs[n].push(t)),t.removeAttribute("bp-ref")}},{key:"bindShow",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=e.getAttribute("bp-show"),i=c.analyzeDecoratorDependency(r),s=a.wrapAbsPath(n,i.modelPath);a.ignoreInnerDirectives(s,[],function(){var n=a.parseData(s,t.$dataList,t.$computedList),r=c.decorate(t.$decoratorList,i,n.data),l=e.style;r?l.removeProperty?l.removeProperty("display"):l.removeAttribute("display"):l.display="none",o.register(t.$registers,t.$dataList,t.$computedList,t.$dataListPure,n.path,function(e,n){c.decorate(t.$decoratorList,i,n)?l.removeProperty?l.removeProperty("display"):l.removeAttribute("display"):l.display="none"})}),e.removeAttribute("bp-show")}},{key:"bindModel",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=e.getAttribute("bp-model"),i=c.analyzeDecoratorDependency(r),s=a.wrapAbsPath(n,i.modelPath);a.ignoreInnerDirectives(s,[],function(){if(/^@{([\d]+)}$/gi.test(s)){var n=s.match(/^@{([\d]+)}$/)[1];"INPUT"===e.tagName?e.value=n:e.innerText=n}else{var r=a.parseData(s,t.$dataList,t.$computedList),l=c.decorate(t.$decoratorList,i,r.data);"INPUT"===e.tagName?e.value=l:e.innerText=l,o.register(t.$registers,t.$dataList,t.$computedList,t.$dataListPure,r.path,function(n,r){var a=c.decorate(t.$decoratorList,i,r);"INPUT"===e.tagName?e.value=a:e.innerText=a})}}),e.removeAttribute("bp-model")}},{key:"bindMoustache",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=t.nodeValue,s=t.nodeValue,l=s.match(/{{.*?}}/gi),u={};if(a.isArray(l)&&l.length>0){l.forEach(function(e){var l=e.slice(2,-2).trim(),d=c.analyzeDecoratorDependency(l);if(/^@{([\d]+)}$/gi.test(d.modelPath))u[e]=d.modelPath.match(/^@{([\d]+)}$/)[1];else{var f=a.parseData(a.wrapAbsPath(r,d.modelPath),n.$dataList,n.$computedList),h=c.decorate(n.$decoratorList,d,f.data);u[e]=h,o.register(n.$registers,n.$dataList,n.$computedList,n.$dataListPure,f.path,function(e,r){var a=c.decorate(n.$decoratorList,d,r),o=f.path.join(".");d.decorators.forEach(function(e){o+="->:"+e}),u["{{ "+o+" }}"]=a;for(var l in u)s=s.replace(l,u[l]);t.nodeValue=s,s=i})}});for(var d in u)s=s.replace(d,u[d])}t.nodeValue=s,s=i}},{key:"bindClass",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=e.getAttribute("bp-class"),i=c.analyzeDecoratorDependency(r),s=a.wrapAbsPath(n,i.modelPath);a.ignoreInnerDirectives(s,[],function(){var n=a.parseData(s,t.$dataList,t.$computedList),r=c.decorate(t.$decoratorList,i,n.data);e.classList.contains(r)||e.classList.add(r),o.register(t.$registers,t.$dataList,t.$computedList,t.$dataListPure,n.path,function(n,r){var a=c.decorate(t.$decoratorList,i,n),o=c.decorate(t.$decoratorList,i,r);e.classList.remove(a),e.classList.contains(o)||e.classList.add(o)})}),e.removeAttribute("bp-class")}},{key:"bindPre",value:function(e){e.removeAttribute("bp-pre")}},{key:"bindEvent",value:function(e,t,n,r){var i=this,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};a.ignoreInnerDirectives(t,[],function(){i.$eventList[t].type=n,e.addEventListener(n,function(){i.$eventList[t].fn.call(i.$dataList,e,r,o)})})}},{key:"bindBind",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];a.ignoreInnerDirectives(t,[],function(){var s=c.analyzeDecoratorDependency(t),l=a.wrapAbsPath(i,s.modelPath),u=a.parseData(l,r.$dataList,r.$computedList),d=c.decorate(r.$decoratorList,s,u.data);e.setAttribute(n,d),o.register(r.$registers,r.$dataList,r.$computedList,r.$dataListPure,u.path,function(t,i){var a=c.decorate(r.$decoratorList,s,i);e.setAttribute(n,a)})})}},{key:"bindFor",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=e.getAttribute("bp-for").split(/\s+in\s+/),l=s[1].split(/->:/i)[0],u=s[0],d=a.randomSequence(12);if(/^@/gi.test(u)||i.trigger("BIND_FOR_INVALID_ALIAS",u),/\./gi.test(l)){var f=l.split(".");n[l]=n[f[0]]+"."+f[1]}else n[l]=l;for(var h=a.clone(n),p=a.clone(r),v=c.analyzeDecorators(s[1]),b=a.parseData(n[l],this.$dataList,this.$computedList),y=c.decorate(this.$decoratorList,v,b.data,!1),m=e.parentNode,g=document.createDocumentFragment(),$=y.length?y.length:y,A=0;A<$;A++){var L=e.cloneNode(!0),P=n[l]+"."+A;n[u]=P,r[u]=A+1,L.removeAttribute("bp-for"),L.setAttribute("bp-for-rendered-id",d),this.bindForItemsRecursion(L,n,r,P,A,!0,function(e){g.appendChild(e)})}m.replaceChild(g,e),o.register(this.$registers,this.$dataList,this.$computedList,this.$dataListPure,b.path,function(n,r){for(var i=document.createDocumentFragment(),a=r.length?r.length:r,o=0;o<a;o++){var s=e.cloneNode(!0),c=h[l]+"."+o;h[u]=c,p[u]=o,s.removeAttribute("bp-for"),s.setAttribute("bp-for-rendered-id",d),t.bindForItemsRecursion(s,h,p,c,o,!0,function(e){i.appendChild(e)})}for(var f=m.querySelectorAll("[bp-for-rendered-id='"+d+"']"),v=0;v<f.length;v++)0===v?m.replaceChild(i,f.item(v)):f.item(v).remove()})}},{key:"bindForItemsRecursion",value:function(e,t,n,r,i){for(var o=this,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=!!a.isHTMLCollection(e),u=0;u<(l?e.length:1);u++){(function(s){var c=l?e[s]:e;if(c.childNodes.forEach(function(e,r){if(e.nodeType===Node.TEXT_NODE){var i=e.nodeValue,s=e.nodeValue,l=i.match(/{{.*?}}/gi),u={};if(a.isArray(l)&&l.length>0){l.forEach(function(e){var r=e.slice(2,-2).trim(),i=r;/^@/gi.test(r)&&(i=/\[\[index\]\]/gi.test(r)?"@{"+n[r.match(/^(.*)\[\[index\]\]$/)[1]]+"}":r.replace(/^@[a-z0-9A-Z_]*/,t[r.split(".")[0]])),u[e]="{{ "+i+" }}"});for(var d in u)i=i.replace(d,u[d])}e.nodeValue=i,i=s,o.bindMoustache(c,e)}}),!c.hasAttributes()&&l)return c.children.length>0&&o.bindForItemsRecursion(c.children,t,n,r,i),"continue";for(var u=c.attributes,d=[],f=0;f<u.length;f++){var h=u.item(f);d.push(h.name),/bp-event/gi.test(h.name)&&function(){var e=[];if(/bp-event:/gi.test(h.name))e.push({_fnType:h.name.split(":")[1],_fnName:h.value});else{h.value.match(/[a-zA-Z]+:[a-zA-Z0-9_$]+/gi).forEach(function(t){e.push({_fnType:t.split(":")[0],_fnName:t.split(":")[1]})})}e.forEach(function(e){var t=e._fnType,n=e._fnName;/^@:/gi.test(n)?o.bindEvent(c,n.split(":")[1],t,o.$dataList,{index:i}):o.bindEvent(c,n,t,o.$dataList,{})}),c.removeAttribute(h.name)}(),/bp-bind/gi.test(h.name)&&function(){var e=[];if(/bp-bind:/gi.test(h.name))e.push({_bindKey:h.name.split(":")[1],_thisSubModelAbs:h.value});else{h.value.match(/[a-zA-Z0-9_$-]+:[a-zA-Z0-9_$.\->:()]+/gi).forEach(function(t){var n=t.split(/:+?/);e.push({_bindKey:n[0],_thisSubModelAbs:n.slice(1).join(":")})})}e.forEach(function(e){var n=e._bindKey,r=e._thisSubModelAbs;/^@/gi.test(r)&&(r=r.replace(/^@[a-z0-9A-Z_]*/,t[r.split(".")[0]])),o.bindBind(c,r,n)}),c.removeAttribute(h.name)}()}if(d.includes("bp-for"))return o.bindFor(c,t,n),"continue";if(d.includes("bp-ref")&&o.bindRef(c),d.includes("bp-class")){var p=c.getAttribute("bp-class"),v=p;/^@/gi.test(p)&&(v=p.replace(/^@[a-z0-9A-Z_]*/,t[p.split(".")[0]])),v!==p&&c.setAttribute("bp-class",v),o.bindClass(c)}if(d.includes("bp-model")){var b=c.getAttribute("bp-model"),y=b;/^@/gi.test(b)&&(y=/\[\[index\]\]/gi.test(b)?"@{"+n[b.match(/^(.*)\[\[index\]\]$/)[1]]+"}":/@{\d+}/gi.test(b)?b:b.replace(/^@[a-z0-9A-Z_]*/,t[b.split(".")[0]])),y!==b&&c.setAttribute("bp-model",y),o.bindModel(c)}if(d.includes("bp-show")){var m=c.getAttribute("bp-show"),g=m;/^@/gi.test(m)&&(g=m.replace(/^@[a-z0-9A-Z_]*/,t[m.split(".")[0]])),g!==m&&c.setAttribute("bp-show",g),o.bindShow(c)}c.children.length>0&&o.bindForItemsRecursion(c.children,t,n,r,i)})(u)}s&&c&&c.call(this,e)}}]),e}()});
//# sourceMappingURL=ballpen.min.js.map
