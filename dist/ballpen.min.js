!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Ballpen=e()}(this,function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var e=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),i=function(){function i(e,n){t(this,i),this.init(e,n),this.scan(this.el)}return e(i,[{key:"init",value:function(t,e){if(this.el=document.querySelector(t),!this.el)throw new Error("[Ballpen] Invalid root element!");if(this.dataModel=e,e.event&&(this.eventList={},this.initEventList(e.event)),e.data&&(this.dataList=e.data,this.modelList={}),e.watchers){this.watchersHook=[];var i=e.watchers;for(var n in i){var a=n,r=i[n];this.watchersHook.push({_dataPath:a,_dataHook:r})}}this.registers=[],this.removedChildNodes=[]}},{key:"initEventList",value:function(t){if(t){var e=t;for(var i in e)this.eventList[i]={},this.eventList[i].type="",this.eventList[i].fn=e[i]}}},{key:"scan",value:function(t){for(var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=0;i<t.children.length;i++){var n=t.children[i];t.innerHTML;this.bind(n),n.children.length>0&&this.scan(n,!1)}e&&(this.update(),this.attach())}},{key:"update",value:function(){this.removedChildNodes.forEach(function(t){t.remove()})}},{key:"bind",value:function(t){if(t.hasAttributes())for(var e=t.attributes,i=0;i<e.length;i++){var n=e.item(i);if("bp-model"===n.name&&this.bindModel(t),"bp-class"===n.name&&this.bindClass(t),/bp-event:/gi.test(n.name)){var a=n.name.split(":")[1],r=n.value;this.bindEvent(t,r,a,this.dataList)}if(/bp-bind:/gi.test(n.name)){var s=n.name.split(":")[1],o=n.value;this.bindBind(t,o,s)}"bp-for"===n.name&&this.bindFor(t),"bp-show"===n.name&&this.bindShow(t)}}},{key:"bindShow",value:function(t){var e=this,n=t.getAttribute("bp-show");i.ignoreInnerDirectives(n,[],function(t){var a=i.parseData(n,e.dataList),r=t.style;a.data?r.removeProperty?r.removeProperty("display"):r.removeAttribute("display"):r.display="none",e.register(e.dataList,a.path,function(t,e){e?r.removeProperty?r.removeProperty("display"):r.removeAttribute("display"):r.display="none"})},t)}},{key:"bindModel",value:function(t){var e=this,n=t.getAttribute("bp-model");i.ignoreInnerDirectives(n,[/^@{([\d]+)}$/gi],function(t){if(/^@{([\d]+)}$/gi.test(n)){var a=n.match(/^@{([\d]+)}$/)[1];"INPUT"===t.tagName?t.value=a:t.innerText=a}else{var r=i.parseData(n,e.dataList);"INPUT"===t.tagName?t.value=r.data:t.innerText=r.data,e.register(e.dataList,r.path,function(e,i){"INPUT"===t.tagName?t.value=i:t.innerText=i})}},t)}},{key:"bindClass",value:function(t){var e=this,n=t.getAttribute("bp-class");i.ignoreInnerDirectives(n,[],function(t){var a=i.parseData(n,e.dataList);t.classList.contains(a.data)||t.classList.add(a.data),e.register(e.dataList,a.path,function(e,i){t.classList.contains(i)||t.classList.add(i)})},t)}},{key:"bindEvent",value:function(t,e,n,a){var r=this;i.ignoreInnerDirectives(e,[],function(t,e,i,n){r.eventList[e].type=i,t.addEventListener(i,function(){r.eventList[e].fn.call(r.dataList,t,n)})},t,e,n,a)}},{key:"bindBind",value:function(t,e,n){var a=this;i.ignoreInnerDirectives(e,[],function(t,e,n){var r=i.parseData(e,a.dataList);t.setAttribute(n,r.data),a.register(a.dataList,r.path,function(e,i){t.setAttribute(n,i)})},t,e,n)}},{key:"bindFor",value:function(t){for(var e=this,n=t.getAttribute("bp-for"),a=i.parseData(n,this.dataList),r=t.parentNode,s=document.createDocumentFragment(),o=0;o<a.data.length;o++){var c=t.cloneNode(!0),l=n+"."+o;c.removeAttribute("bp-for"),s.appendChild(this.bindForItems(c,l,o))}r.appendChild(s),this.register(this.dataList,a.path,function(i,a){for(var s=document.createDocumentFragment(),o=0;o<a.length;o++){var c=t.cloneNode(!0),l=n+"."+o;s.appendChild(e.bindForItems(c,l,o))}for(;r.firstChild;)r.removeChild(r.firstChild);r.appendChild(s)}),this.removedChildNodes.push(t)}},{key:"bindForItemsRecursion",value:function(t,e,n){var a=!0;i.isHTMLCollection(t)||(a=!1);for(var r=0;r<(a?t.length:1);r++){var s=a?t[r]:t;if(s.hasAttributes()||!a){for(var o=s.attributes,c=0;c<o.length;c++){var l=o.item(c);if("bp-class"===l.name){var u=s.getAttribute("bp-class"),h=u;if(/^@\./gi.test(u)){var d=u.split(".")[1];h=e+("."+d)}else/^@$/gi.test(u)&&(h=e);h!==u&&s.setAttribute("bp-class",h),this.bindClass(s)}if(/bp-event:/gi.test(l.name)){var v=l.name.split(":")[1],f=l.value;/^@:/gi.test(f)&&this.bindEvent(s,f.split(":")[1],v,i.parseData(e,this.dataList).data)}if("bp-model"===l.name){var p=s.getAttribute("bp-model"),b=p;if(/^@\./gi.test(p)){var y=p.split(".")[1];b=e+("."+y)}else/^@$/gi.test(p)?b=e:/^@{index}$/gi.test(p)&&(b="@{"+n+"}");b!==p&&s.setAttribute("bp-model",b),this.bindModel(s)}if("bp-show"===l.name){var g=s.getAttribute("bp-show"),m=g;if(/^@\./gi.test(g)){var k=g.split(".")[1];m=e+("."+k)}else/^@$/gi.test(g)&&(m=e);m!==g&&s.setAttribute("bp-show",m),this.bindShow(s)}}s.children.length>0&&this.bindForItemsRecursion(s.children,e,n)}}}},{key:"bindForItems",value:function(t,e,i){return this.bindForItemsRecursion(t,e,i),t}},{key:"observePath",value:function(t,e,n){var a=this,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];i.isArray(e)&&!function(){var i=t,s=void 0;e.forEach(function(t,n){/^\d+$/.test(t)&&(t=parseInt(t)),n<e.length-1?i=i[t]:s=t}),a.observeKey(i,s,n,r)}()}},{key:"observeKey",value:function(t,e){var n=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];i.isArray(e)?this.observePath(t,e,a,r):!function(){var s=t[e];i.isObject(s)?(Object.defineProperty(t,e,{get:function(){return s},set:function(t){t!==s&&a&&a.forEach(function(e){e.call(n,s,t)}),s=t},enumerable:!0,configurable:!0}),Object.keys(s).forEach(function(t){n.observeKey(s,t,a,r)})):i.isArray(s)?n.observeArray(s,a,r):Object.defineProperty(t,e,{get:function(){return s},set:function(t){t!==s&&a&&a.forEach(function(e){e.call(n,s,t)}),s=t},enumerable:!0,configurable:!0})}()}},{key:"observeArray",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=["copyWithin","fill","pop","push","reverse","shift","sort","splice","unshift"],r=Array.prototype,s=Object.create(r);a.forEach(function(n){Object.defineProperty(s,n,{enumerable:!0,configurable:!0,writable:!0,value:function(){for(var a,s=arguments.length,o=Array(s),c=0;c<s;c++)o[c]=arguments[c];var l=t.slice(),u=(a=r[n]).call.apply(a,[t].concat(o)),h=t;return i&&i.forEach(function(t){t.call(e,l,h)}),u}})}),t.__proto__=s,n&&t.forEach(function(t,n,a){e.observeKey(a,n,i,!0)})}},{key:"register",value:function t(e,i,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=this.registers.find(function(t){if(Object.is(t.obj,e)&&(t.key===i||t.key.toString()===i.toString()))return t});t?t.fns.push(n):this.registers.push({obj:e,key:i,fns:[n],deep:a})}},{key:"attach",value:function(){var t=this;this.watchersHook.forEach(function(e){var n=i.parseData(e._dataPath,t.dataList);t.register(t.dataList,n.path,function(){for(var i,n=arguments.length,a=Array(n),r=0;r<n;r++)a[r]=arguments[r];(i=e._dataHook).call.apply(i,[t].concat(a))},{root:n.path.join(".")})}),this.registers.forEach(function(e){t.observeKey(e.obj,e.key,e.fns,e.deep)})}}],[{key:"isHTMLCollection",value:function(t){return"[object HTMLCollection]"===Object.prototype.toString.call(t)}},{key:"isArray",value:function(t){return Array.isArray(t)||"[object Array]"===Object.prototype.toString.call(t)}},{key:"isObject",value:function(t){return"[object Object]"===Object.prototype.toString.call(t)}},{key:"parseData",value:function(t,e){var i=t.split("."),n=void 0,a=[];return i.forEach(function(t,i){0===i?(n=e[t],a.push(t)):(n=n[t],a.push(t))}),{path:a,data:n}}},{key:"ignoreInnerDirectives",value:function(t,e,i){for(var n=arguments.length,a=Array(n>3?n-3:0),r=3;r<n;r++)a[r-3]=arguments[r];var s=this;e.forEach(function(e){e.test(t)&&i&&i.call.apply(i,[s].concat(a))}),/^@/gi.test(t)||i&&i.call.apply(i,[this].concat(a))}}]),i}();return i});
//# sourceMappingURL=ballpen.min.js.map
