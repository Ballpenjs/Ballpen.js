!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Ballpen=t()}(this,function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function t(){e(this,t)}return i(t,null,[{key:"findReferenceNode",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=i;if(t.isObject(e))for(var a in e)(t.isObject(e[a])||t.isArray(e[a]))&&(r+=a+".",n.set(r.slice(0,-1),[]),t.findReferenceNode(e[a],n,r));else t.isArray(e)&&e.forEach(function(e,i){(t.isObject(e)||t.isArray(e))&&(r+=i+".",n.set(r.slice(0,-1),[]),t.findReferenceNode(e,n,r))});return n}},{key:"isHTMLCollection",value:function(e){return"[object HTMLCollection]"===Object.prototype.toString.call(e)}},{key:"isArray",value:function(e){return Array.isArray(e)||"[object Array]"===Object.prototype.toString.call(e)}},{key:"toArray",value:function(e){return Array.prototype.slice.call(e)}},{key:"isObject",value:function(e){return"[object Object]"===Object.prototype.toString.call(e)}},{key:"isReferenceType",value:function(e){return t.isObject(e)||t.isArray(e)}},{key:"renderObjectValueByPath",value:function(e,n,i){var r=n.split(".");if("undefined"==typeof t.parseData(n,e).data&&t.throwError('Find an invalid watcher path when initializing Ballpen.js -> "'+n+'"',"Please make sure the watcher path you set is exist and valid."),1===r.length)e[r[0]]=i;else for(var a=0;a<r.length-1;a++)e=e[r[a]],e||t.throwError('Find an invalid watcher path when initializing Ballpen.js -> "'+n+'"',"Please make sure the watcher path you set is exist and valid."),a===r.length-2&&(e[r[r.length-1]]=i)}},{key:"parseData",value:function(e,t){var n=e.split("."),i=t,r=[];return n.forEach(function(e,n){0===n?(i=t[e],r.push(e)):(i=i[e],r.push(e))}),{path:r,data:i}}},{key:"ignoreInnerDirectives",value:function(e,t,n){for(var i=arguments.length,r=Array(i>3?i-3:0),a=3;a<i;a++)r[a-3]=arguments[a];var o=this;t.forEach(function(t){t.test(e)&&n&&n.call.apply(n,[o].concat(r))}),/^@/gi.test(e)||n&&n.call.apply(n,[this].concat(r))}},{key:"clone",value:function(e){var i=void 0;if(null===e||"object"!==("undefined"==typeof e?"undefined":n(e)))return e;if(e instanceof Date)return i=new Date,i.setTime(e.getTime()),i;if(e instanceof Array){i=[];for(var r=0,a=e.length;r<a;r++)i[r]=t.clone(e[r]);return i}if(e instanceof Object){i={};for(var o in e)e.hasOwnProperty(o)&&(i[o]=t.clone(e[o]));return i}t.throwError("Internal error, unable to copy object, type is not supported.","Please contact the author to fix this issue.")}},{key:"wrapAbsPath",value:function(e,n){return(t.isArray(e)&&e.length>0?e.join(".")+".":e.toString().length>0?e.toString()+".":"")+(t.isArray(n)&&n.length>0?n.join("."):n.toString().length>0?n.toString():"")}},{key:"throwError",value:function(e,t){var n=new Error("[Ballpen Parser Error] \n\n [Message] \n\n - "+e+" \n\n [Description] \n\n - "+t+" \n");throw n.name="BallpenError",n}},{key:"randomSequence",value:function(e){for(var t=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],n="",i=0;i<e;i++){var r=Math.ceil(35*Math.random());n+=t[r]}return n}}]),t}(),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(n,i){t(this,e),this.init(n,i),this.scan(this.$el)}return a(e,[{key:"init",value:function(e,t){var n=this;if(this.$el=document.querySelector(e),this.$el||r.throwError('Find an invalid root element when initializing Ballpen.js -> "'+e+'"','Well, you should set a valid root element for Ballpen.js first constructor parameter, eg: "#app", "#container".'),t.events&&(this.$eventList={},this.initEventList(t.events)),t.data&&(this.$dataListPure=t.data,this.data=this.$dataListPure,this.$dataList=r.clone(t.data)),t.watchers){this.watchersHook=r.findReferenceNode(this.$dataList);var i=t.watchers,a=function(e){var t={root:e,handler:i[e].handler};n.watchersHook.forEach(function(n,i){new RegExp("^"+e,"ig").test(i)&&n.push(t)})};for(var o in i)a(o);this.watchersHook.forEach(function(e,t){r.renderObjectValueByPath(n.$dataList,t,n.setProxy(t,e))})}this.$registers=[]}},{key:"setProxy",value:function(e,t){var n=this,i=r.parseData(e,this.$dataList).data,a=r.parseData(e,this.$dataListPure).data,o={get:function(e,n){return t.forEach(function(e){e.handler,e.root}),e[n]},set:function(i,o,s,c){if(s!==a[o]){var l=void 0;r.isReferenceType(s)?(a[o]=r.clone(s),l=r.clone(s)):(a[o]=s,l=s),r.renderObjectValueByPath(n.$dataListPure,e+"."+o,l),i[o]=s,t.forEach(function(e){var t=e.handler,i=e.root;t&&t.call(n,r.parseData(i,n.$dataListPure).data,r.parseData(i,n.$dataList).data)})}return!0},defineProperty:function(e,t,n){return Reflect.defineProperty(e,t,n)}};return new Proxy(i,o)}},{key:"initEventList",value:function(e){if(e){var t=e;for(var n in t)this.$eventList[n]={},this.$eventList[n].type="",this.$eventList[n].fn=t[n]}}},{key:"scan",value:function(e){for(var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=function(n){var i=e.children[n];if(i.hasAttributes()){for(var r=i.attributes,a=[],o=0;o<r.length;o++){var s=r.item(o);a.push(s.name),/bp-event/gi.test(s.name)&&!function(){i.removeAttribute(s.name);var e=[],n=s;if(/bp-event:/gi.test(n.name))e.push({_fnType:n.name.split(":")[1],_fnName:n.value});else{var r=n.value.match(/[a-zA-Z]+:[a-zA-Z0-9_$]+/gi);r.forEach(function(t){e.push({_fnType:t.split(":")[0],_fnName:t.split(":")[1]})})}e.forEach(function(e){var n=e._fnType,r=e._fnName;t.bindEvent(i,r,n,t.$dataList,{})})}(),/bp-bind/gi.test(s.name)&&!function(){i.removeAttribute(s.name);var e=[],n=s;if(/bp-bind:/gi.test(n.name))e.push({_bindKey:n.name.split(":")[1],_thisSubModelAbs:n.value});else{var r=n.value.match(/[a-zA-Z0-9_$-]+:[a-zA-Z0-9_$.]+/gi);r.forEach(function(t){e.push({_bindKey:t.split(":")[0],_thisSubModelAbs:t.split(":")[1]})})}e.forEach(function(e){var n=e._bindKey,r=e._thisSubModelAbs;t.bindBind(i,r,n)})}()}if(a.includes("bp-pre"))return t.bindPre(i),"continue";if(a.includes("bp-for"))return t.bindFor(i),"continue";a.includes("bp-model")&&t.bindModel(i),a.includes("bp-class")&&t.bindClass(i),a.includes("bp-show")&&t.bindShow(i)}var c=i.childNodes;c.forEach(function(e,n){e.nodeType===Node.TEXT_NODE&&t.bindMoustache(i,e)}),i.children.length>0&&t.scan(i,!1)},r=0;r<e.children.length;r++){i(r)}n&&(this.attach(),this.$el.removeAttribute("bp-shade"))}},{key:"bindShow",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=r.wrapAbsPath(n,e.getAttribute("bp-show"));r.ignoreInnerDirectives(i,[],function(e){var n=r.parseData(i,t.$dataList),a=e.style;n.data?a.removeProperty?a.removeProperty("display"):a.removeAttribute("display"):a.display="none",t.register(t.$dataList,t.$dataListPure,n.path,function(e,t){t?a.removeProperty?a.removeProperty("display"):a.removeAttribute("display"):a.display="none"})},e),e.removeAttribute("bp-show")}},{key:"bindModel",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=r.wrapAbsPath(n,e.getAttribute("bp-model"));r.ignoreInnerDirectives(i,[/^@{([\d]+)}$/gi],function(e){if(/^@{([\d]+)}$/gi.test(i)){var n=i.match(/^@{([\d]+)}$/)[1];"INPUT"===e.tagName?e.value=n:e.innerText=n}else{var a=r.parseData(i,t.$dataList);"INPUT"===e.tagName?e.value=a.data:e.innerText=a.data,t.register(t.$dataList,t.$dataListPure,a.path,function(t,n){"INPUT"===e.tagName?e.value=n:e.innerText=n})}},e),e.removeAttribute("bp-model")}},{key:"bindMoustache",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=t.nodeValue,o=t.nodeValue,s=o.match(/{{.*?}}/gi),c={};if(r.isArray(s)&&s.length>0){s.forEach(function(e){var s=e.slice(2,-2).trim();/^@{([\d]+)}$/gi.test(s)?c[e]=s.match(/^@{([\d]+)}$/)[1]:!function(){var l=r.parseData(r.wrapAbsPath(i,s),n.$dataList);c[e]=l.data,n.register(n.$dataList,n.$dataListPure,l.path,function(e,n){c["{{ "+l.path.join(".")+" }}"]=n;for(var i in c)o=a.replace(i,c[i]);t.nodeValue=o})}()});for(var l in c)o=a.replace(l,c[l])}t.nodeValue=o}},{key:"bindClass",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=r.wrapAbsPath(n,e.getAttribute("bp-class"));r.ignoreInnerDirectives(i,[],function(e){var n=r.parseData(i,t.$dataList);e.classList.contains(n.data)||e.classList.add(n.data),t.register(t.$dataList,t.$dataListPure,n.path,function(t,n){e.classList.remove(t),e.classList.contains(n)||e.classList.add(n)})},e),e.removeAttribute("bp-class")}},{key:"bindPre",value:function(e){e.removeAttribute("bp-pre")}},{key:"bindEvent",value:function(e,t,n,i){var a=this,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};r.ignoreInnerDirectives(t,[],function(e,t,n,i){a.$eventList[t].type=n,e.addEventListener(n,function(){a.$eventList[t].fn.call(a.$dataList,e,i,o)})},e,t,n,i,o)}},{key:"bindBind",value:function(e,t,n){var i=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];r.ignoreInnerDirectives(t,[],function(e,t,n){var o=r.wrapAbsPath(a,t),s=r.parseData(o,i.$dataList);e.setAttribute(n,s.data),i.register(i.$dataList,i.$dataListPure,s.path,function(t,i){e.setAttribute(n,i)})},e,t,n)}},{key:"bindFor",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=e.getAttribute("bp-for").split(/\s+in\s+/),o=a[1],s=a[0],c=r.randomSequence(12);if(/^@/gi.test(s)||r.throwError('Invalid alias name when initializing a "bp-for" condition -> "'+s+'".','Please make sure the alias name is start with a "@" symbol.'),/\./gi.test(o)){var l=o.split(".");n[o]=n[l[0]]+"."+l[1]}else n[o]=o;for(var u=r.clone(n),f=r.clone(i),d=r.parseData(n[o],this.$dataList),h=e.parentNode,p=document.createDocumentFragment(),v=0;v<d.data.length;v++){var b=e.cloneNode(!0),y=n[o]+"."+v;n[s]=y,i[s]=v,b.removeAttribute("bp-for"),b.setAttribute("bp-for-rendered-id",c),this.bindForItemsRecursion(b,n,i,y,v,!0,function(e){p.appendChild(e)})}h.replaceChild(p,e),this.register(this.$dataList,this.$dataListPure,d.path,function(n,i){for(var r=document.createDocumentFragment(),a=0;a<i.length;a++){var l=e.cloneNode(!0),d=u[o]+"."+a;u[s]=d,f[s]=a,l.removeAttribute("bp-for"),l.setAttribute("bp-for-rendered-id",c),t.bindForItemsRecursion(l,u,f,d,a,!0,function(e){r.appendChild(e)})}for(var p=h.querySelectorAll("[bp-for-rendered-id='"+c+"']"),v=0;v<p.length;v++)0===v?h.replaceChild(r,p.item(v)):p.item(v).remove()})}},{key:"bindForItemsRecursion",value:function(e,t,n,i,a){for(var o=this,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=!!r.isHTMLCollection(e),u=function(s){var c=l?e[s]:e,u=c.childNodes;if(u.forEach(function(e,i){e.nodeType===Node.TEXT_NODE&&!function(){var i=e.nodeValue,a=e.nodeValue,s=a.match(/{{.*?}}/gi),l={};if(r.isArray(s)&&s.length>0){s.forEach(function(e){var i=e.slice(2,-2).trim(),r=i;/^@/gi.test(i)&&(r=/\[\[index\]\]/gi.test(i)?"@{"+n[i.match(/^(.*)\[\[index\]\]$/)[1]]+"}":i.replace(/^@[a-z0-9A-Z_]*/,t[i.split(".")[0]])),l[e]="{{ "+r+" }}"});for(var u in l)a=i.replace(u,l[u])}e.nodeValue=a,o.bindMoustache(c,e)}()}),!c.hasAttributes()&&l)return c.children.length>0&&o.bindForItemsRecursion(c.children,t,n,i,a),"continue";for(var f=c.attributes,d=[],h=0;h<f.length;h++){var p=f.item(h);d.push(p.name),/bp-event/gi.test(p.name)&&!function(){var e=[];if(/bp-event:/gi.test(p.name))e.push({_fnType:p.name.split(":")[1],_fnName:p.value});else{var t=p.value.match(/[a-zA-Z]+:[a-zA-Z0-9_$]+/gi);t.forEach(function(t){e.push({_fnType:t.split(":")[0],_fnName:t.split(":")[1]})})}e.forEach(function(e){var t=e._fnType,n=e._fnName;/^@:/gi.test(n)?o.bindEvent(c,n.split(":")[1],t,o.$dataList,{index:a}):o.bindEvent(c,n,t,o.$dataList,{})})}(),/bp-bind/gi.test(p.name)&&!function(){var e=[];if(/bp-bind:/gi.test(p.name))e.push({_bindKey:p.name.split(":")[1],_thisSubModelAbs:p.value});else{var n=p.value.match(/[a-zA-Z0-9_$-]+:[a-zA-Z0-9_$.]+/gi);n.forEach(function(t){e.push({_bindKey:t.split(":")[0],_thisSubModelAbs:t.split(":")[1]})})}e.forEach(function(e){var n=e._bindKey,i=e._thisSubModelAbs;/^@/gi.test(i)&&(i=i.replace(/^@[a-z0-9A-Z_]*/,t[i.split(".")[0]])),o.bindBind(c,i,n)})}()}if(d.includes("bp-for"))return o.bindFor(c,t,n),"continue";if(d.includes("bp-class")){var v=c.getAttribute("bp-class"),b=v;/^@/gi.test(v)&&(b=v.replace(/^@[a-z0-9A-Z_]*/,t[v.split(".")[0]])),b!==v&&c.setAttribute("bp-class",b),o.bindClass(c)}if(d.includes("bp-model")){var y=c.getAttribute("bp-model"),g=y;/^@/gi.test(y)&&(g=/\[\[index\]\]/gi.test(y)?"@{"+n[y.match(/^(.*)\[\[index\]\]$/)[1]]+"}":/@{\d+}/gi.test(y)?y:y.replace(/^@[a-z0-9A-Z_]*/,t[y.split(".")[0]])),g!==y&&c.setAttribute("bp-model",g),o.bindModel(c)}if(d.includes("bp-show")){var m=c.getAttribute("bp-show"),A=m;/^@/gi.test(m)&&(A=m.replace(/^@[a-z0-9A-Z_]*/,t[m.split(".")[0]])),A!==m&&c.setAttribute("bp-show",A),o.bindShow(c)}c.children.length>0&&o.bindForItemsRecursion(c.children,t,n,i,a)},f=0;f<(l?e.length:1);f++){u(f)}s&&c&&c.call(this,e)}},{key:"observePath",value:function(e,t,n,i){var a=this;r.isArray(n)&&!function(){var r=e,o=void 0;n.forEach(function(e,t){/^\d+$/.test(e)&&(e=parseInt(e)),t<n.length-1?r=r[e]:o=e}),t=n.join("."),a.observeKey(r,t,o,i)}()}},{key:"observeKey",value:function(e,t,n){var i=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];r.isArray(n)?this.observePath(e,t,n,a):!function(){var o=e[n],s=t;r.isObject(o)?(Object.defineProperty(e,n,{get:function(){return o},set:function(e){e!==o&&(a&&a.forEach(function(t){t.call(i,o,e)}),o=e,r.renderObjectValueByPath(i.$dataListPure,s,e))},enumerable:!0,configurable:!0}),Object.keys(o).forEach(function(e){i.observeKey(o,s+"."+e,e,a)})):r.isArray(o)?(Object.defineProperty(e,n,{get:function(){return o},set:function(e){e!==o&&(a&&a.forEach(function(t){t.call(i,o,e)}),o=e,r.renderObjectValueByPath(i.$dataListPure,s,e))},enumerable:!0,configurable:!0}),i.observeArray(o,s,a)):Object.defineProperty(e,n,{get:function(){return o},set:function(e){e!==o&&(a&&a.forEach(function(t){t.call(i,o,e)}),o=e,r.renderObjectValueByPath(i.$dataListPure,s,e))},enumerable:!0,configurable:!0})}()}},{key:"observeArray",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=["copyWithin","fill","pop","push","reverse","shift","sort","splice","unshift"],o=Array.prototype,s=Object.create(o),c=t;a.forEach(function(t){Object.defineProperty(s,t,{enumerable:!0,configurable:!0,writable:!0,value:function(){for(var a,s=arguments.length,l=Array(s),u=0;u<s;u++)l[u]=arguments[u];var f=e.slice(),d=(a=o[t]).call.apply(a,[e].concat(l)),h=e;return r.renderObjectValueByPath(n.$dataListPure,c,h),i&&i.forEach(function(e){e.call(n,f,h)}),d}})}),e.__proto__=s}},{key:"register",value:function e(t,n,i,r){var e=this.$registers.find(function(e){if(Object.is(e.obj,t)&&(e.key===i||e.key.toString()===i.toString()))return e});e?e.fns.push(r):this.$registers.push({obj:t,rootPath:[],key:i,fns:[r]})}},{key:"attach",value:function(){var e=this;this.$registers.forEach(function(t){e.observeKey(t.obj,t.rootPath,t.key,t.fns)})}}]),e}();return o});
//# sourceMappingURL=ballpen.min.js.map
