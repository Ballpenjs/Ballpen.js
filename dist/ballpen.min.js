!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Ballpen=e()}(this,function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var e=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),i=function(){function i(e,r){t(this,i),this.init(e,r),this.scan(this.el)}return e(i,[{key:"init",value:function(t,e){if(this.el=document.querySelector(t),!this.el)throw new Error("[Ballpen] Invalid root element!");this.dataModel=e,e.event&&(this.eventList={},this.initEventList(e.event)),e.data&&(this.dataList=e.data,this.modelList={}),this.registers=[]}},{key:"initEventList",value:function(t){if(t){var e=t;for(var i in e)this.eventList[i]={},this.eventList[i].type="",this.eventList[i].fn=e[i]}}},{key:"scan",value:function(t){for(var e=0;e<t.children.length;e++){var i=t.children[e];console.log(i),this.bind(i),i.children.length>0&&this.scan(i)}this.attach()}},{key:"bind",value:function(t){if(t.hasAttributes())for(var e=t.attributes,i=0;i<e.length;i++){var r=e.item(i);if("bp-model"===r.name&&this.bindModel(t),"bp-class"===r.name&&this.bindClass(t),/bp-event:/gi.test(r.name)){var n=r.name.split(":")[1],a=r.value;this.bindEvent(t,a,n)}"bp-for"===r.name&&this.bindFor(t),"bp-show"===r.name&&this.bindShow(t)}}},{key:"bindShow",value:function(t){var e=t.getAttribute("bp-show"),r=i.parseData(e,this.dataList),n=t.style;r.data?n.removeProperty?n.removeProperty("display"):n.removeAttribute("display"):n.display="none",this.register(this.dataList,r.path,function(t,e){e?n.removeProperty?n.removeProperty("display"):n.removeAttribute("display"):n.display="none"})}},{key:"bindModel",value:function(t){var e=t.getAttribute("bp-model"),r=i.parseData(e,this.dataList);"INPUT"===t.tagName?t.value=r.data:t.innerText=r.data,this.register(this.dataList,r.path,function(e,i){"INPUT"===t.tagName?t.value=i:t.innerText=i})}},{key:"bindClass",value:function(t){var e=t.getAttribute("bp-class"),r=i.parseData(e,this.dataList);t.classList.contains(r.data)||t.classList.add(r.data),this.register(this.dataList,r.path,function(e,i){t.classList.contains(i)||t.classList.add(i)})}},{key:"bindEvent",value:function(t,e,i){var r=this;this.eventList[e].type=i,t.addEventListener(i,function(){r.eventList[e].fn.call(r.dataList,t)})}},{key:"bindFor",value:function(t){for(var e=this,r=t.getAttribute("bp-for"),n=i.parseData(r,this.dataList),a=t.parentNode,o=document.createDocumentFragment(),s=0;s<n.data.length;s++){var l=t.cloneNode(!0),u=r+"."+s;l.removeAttribute("bp-for"),o.appendChild(this.bindForItems(l,u))}a.appendChild(o),this.register(this.dataList,n.path,function(i,n){for(var o=document.createDocumentFragment(),s=0;s<n.length;s++){var l=t.cloneNode(!0),u=r+"."+s;o.appendChild(e.bindForItems(l,u))}for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(o)}),t.remove()}},{key:"bindForItemsRecursion",value:function(t,e){var r=!0;i.isHTMLCollection(t)||(r=!1);for(var n=0;n<(r?t.length:1);n++){var a=r?t[n]:t;if(a.hasAttributes()||!r){for(var o=a.attributes,s=0;s<o.length;s++){var l=o.item(s);if("bp-for-show"===l.name){var u=a.getAttribute("bp-for-show"),c=e+("."+u);a.setAttribute("bp-show",c),a.removeAttribute("bp-for-show")}if("bp-for-class"===l.name){var h=a.getAttribute("bp-for-class"),f=e+("."+h);a.setAttribute("bp-class",f),a.removeAttribute("bp-for-class")}if("bp-for-model"===l.name){var v=a.getAttribute("bp-for-model"),d=void 0;if(/^@\./gi.test(v)){var b=v.split(".")[1];d=e+("."+b)}else/^@$/gi.test(v)&&(d=e);a.setAttribute("bp-model",d),a.removeAttribute("bp-for-model")}}for(var p=a.attributes,y=0;y<p.length;y++){var m=p.item(y);if("bp-class"===m.name&&this.bindClass(a),/bp-event:/gi.test(m.name)){var g=m.name.split(":")[1],A=m.value;this.bindEvent(a,A,g)}"bp-model"===m.name&&this.bindModel(a),"bp-show"===m.name&&this.bindShow(a)}a.children.length>0&&this.bindForItemsRecursion(a.children,e)}}}},{key:"bindForItems",value:function(t,e){return this.bindForItemsRecursion(t,e),t}},{key:"observePath",value:function(t,e,r){var n=this;i.isArray(e)&&!function(){var i=t,a=void 0;e.forEach(function(t,r){/^\d+$/.test(t)&&(t=parseInt(t)),r<e.length-1?i=i[t]:a=t}),n.observeKey(i,a,r)}()}},{key:"observeKey",value:function(t,e){var r=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];i.isArray(e)?this.observePath(t,e,n):!function(){var a=t[e];i.isObject(a)?Object.keys(a).forEach(function(t){r.observeKey(a,t,n)}):i.isArray(a)?r.observeArray(a,n):Object.defineProperty(t,e,{get:function(){return a},set:function(t){t!==a&&n&&n.forEach(function(e){e.call(r,a,t)}),a=t},enumerable:!0,configurable:!0})}()}},{key:"observeArray",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=["copyWithin","fill","pop","push","reverse","shift","sort","splice","unshift"],n=Array.prototype,a=Object.create(n);r.forEach(function(r){Object.defineProperty(a,r,{enumerable:!0,configurable:!0,writable:!0,value:function(){for(var a,o=arguments.length,s=Array(o),l=0;l<o;l++)s[l]=arguments[l];var u=t.slice(),c=(a=n[r]).call.apply(a,[t].concat(s)),h=t;return i&&i.forEach(function(t){t.call(e,u,h)}),c}})}),t.__proto__=a,t.__proto__.__proto__===Array.prototype}},{key:"register",value:function t(e,i,r){var t=this.registers.find(function(t){if(Object.is(t.obj,e)&&(t.key===i||t.key.toString()===i.toString()))return t});t?t.fns.push(r):this.registers.push({obj:e,key:i,fns:[r]})}},{key:"attach",value:function(){var t=this;this.registers.forEach(function(e){t.observeKey(e.obj,e.key,e.fns)})}}],[{key:"isHTMLCollection",value:function(t){return"[object HTMLCollection]"===Object.prototype.toString.call(t)}},{key:"isArray",value:function(t){return Array.isArray(t)||"[object Array]"===Object.prototype.toString.call(t)}},{key:"isObject",value:function(t){return"[object Object]"===Object.prototype.toString.call(t)}},{key:"parseData",value:function(t,e){var i=t.split("."),r=void 0,n=[];return i.forEach(function(t,i){0===i?(r=e[t],n.push(t)):(r=r[t],n.push(t))}),{path:n,data:r}}}]),i}();return i});
//# sourceMappingURL=ballpen.min.js.map
