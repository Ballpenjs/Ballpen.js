!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Ballpen=e()}(this,function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),n=function(){function n(e,i){t(this,n),this.init(e,i),this.scan(this.el)}return i(n,[{key:"init",value:function(t,e){var i=this;if(this.el=document.querySelector(t),!this.el)throw new Error("[Ballpen] Invalid root element!");if(this.dataModel=e,e.event&&(this.eventList={},this.initEventList(e.event)),e.data&&(this.dataListPure=e.data,this.dataList=n.clone(e.data),this.modelList={}),e.watchers){this.watchersHook=new Map;var r=e.watchers;for(var a in r){var o=a,s=r[a].handler;this.watchersHook.set(o,s)}this.watchersHook.forEach(function(t,e){var r=n.parseData(e,i.dataList),a=e.split("."),o=i.dataList;if(!r.data)throw new Error('[Ballpen] "'+e+'" is an invalid watch path.');if(1===a.length)i.dataList[a[0]]=i.setProxy(r.data,e,t,t);else for(var s=0;s<a.length-1;s++){if(o=o[a[s]],!o)throw new Error('[Ballpen] "'+e+'" is an invalid watch path.');s===a.length-2&&(o[a[a.length-1]]=i.setProxy(r.data,e,t,t))}})}this.registers=[],this.removedChildNodes=[]}},{key:"setProxy",value:function(t,e){var i=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o={get:function(t,r){return a&&a.call(i,n.parseData(e,i.dataListPure).data),t[r]},set:function(t,a,o,s){return t[a]=o,r&&r.call(i,n.parseData(e,i.dataListPure).data),!0},defineProperty:function(t,e,i){return Reflect.defineProperty(t,e,i)}};return new Proxy(t,o)}},{key:"initEventList",value:function(t){if(t){var e=t;for(var i in e)this.eventList[i]={},this.eventList[i].type="",this.eventList[i].fn=e[i]}}},{key:"scan",value:function(t){for(var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=0;i<t.children.length;i++){var n=t.children[i];t.innerHTML;this.bind(n),n.children.length>0&&this.scan(n,!1)}e&&(this.update(),this.attach())}},{key:"update",value:function(){this.removedChildNodes.forEach(function(t){t.remove()})}},{key:"bind",value:function(t){if(t.hasAttributes())for(var e=t.attributes,i=0;i<e.length;i++){var n=e.item(i);if("bp-model"===n.name&&this.bindModel(t),"bp-class"===n.name&&this.bindClass(t),/bp-event:/gi.test(n.name)){var r=n.name.split(":")[1],a=n.value;this.bindEvent(t,a,r,this.dataList)}if(/bp-bind:/gi.test(n.name)){var o=n.name.split(":")[1],s=n.value;this.bindBind(t,s,o)}"bp-for"===n.name&&this.bindFor(t),"bp-show"===n.name&&this.bindShow(t)}}},{key:"bindShow",value:function(t){var e=this,i=t.getAttribute("bp-show");n.ignoreInnerDirectives(i,[],function(t){var r=n.parseData(i,e.dataList),a=t.style;r.data?a.removeProperty?a.removeProperty("display"):a.removeAttribute("display"):a.display="none",e.register(e.dataList,e.dataListPure,r.path,function(t,e){e?a.removeProperty?a.removeProperty("display"):a.removeAttribute("display"):a.display="none"})},t)}},{key:"bindModel",value:function(t){var e=this,i=t.getAttribute("bp-model");n.ignoreInnerDirectives(i,[/^@{([\d]+)}$/gi],function(t){if(/^@{([\d]+)}$/gi.test(i)){var r=i.match(/^@{([\d]+)}$/)[1];"INPUT"===t.tagName?t.value=r:t.innerText=r}else{var a=n.parseData(i,e.dataList);"INPUT"===t.tagName?t.value=a.data:t.innerText=a.data,e.register(e.dataList,e.dataListPure,a.path,function(e,i){"INPUT"===t.tagName?t.value=i:t.innerText=i})}},t)}},{key:"bindClass",value:function(t){var e=this,i=t.getAttribute("bp-class");n.ignoreInnerDirectives(i,[],function(t){var r=n.parseData(i,e.dataList);t.classList.contains(r.data)||t.classList.add(r.data),e.register(e.dataList,e.dataListPure,r.path,function(e,i){t.classList.contains(i)||t.classList.add(i)})},t)}},{key:"bindEvent",value:function(t,e,i,r){var a=this,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};n.ignoreInnerDirectives(e,[],function(t,e,i,n){a.eventList[e].type=i,t.addEventListener(i,function(){a.eventList[e].fn.call(a.dataList,t,n,o)})},t,e,i,r,o)}},{key:"bindBind",value:function(t,e,i){var r=this;n.ignoreInnerDirectives(e,[],function(t,e,i){var a=n.parseData(e,r.dataList);t.setAttribute(i,a.data),r.register(r.dataList,r.dataListPure,a.path,function(e,n){t.setAttribute(i,n)})},t,e,i)}},{key:"bindFor",value:function(t){for(var e=this,i=t.getAttribute("bp-for"),r=n.parseData(i,this.dataList),a=t.parentNode,o=document.createDocumentFragment(),s=0;s<r.data.length;s++){var l=t.cloneNode(!0),c=i+"."+s;l.removeAttribute("bp-for"),o.appendChild(this.bindForItems(l,c,s))}a.appendChild(o),this.register(this.dataList,this.dataListPure,r.path,function(n,r){for(var o=document.createDocumentFragment(),s=0;s<r.length;s++){var l=t.cloneNode(!0),c=i+"."+s;o.appendChild(e.bindForItems(l,c,s))}for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(o)}),this.removedChildNodes.push(t)}},{key:"bindForItemsRecursion",value:function(t,e,i){var r=!0;n.isHTMLCollection(t)||(r=!1);for(var a=0;a<(r?t.length:1);a++){var o=r?t[a]:t;if(o.hasAttributes()||!r){for(var s=o.attributes,l=0;l<s.length;l++){var c=s.item(l);if("bp-class"===c.name){var u=o.getAttribute("bp-class"),f=u;if(/^@\./gi.test(u)){var d=u.split(".")[1];f=e+("."+d)}else/^@$/gi.test(u)&&(f=e);f!==u&&o.setAttribute("bp-class",f),this.bindClass(o)}if(/bp-event:/gi.test(c.name)){var h=c.name.split(":")[1],v=c.value;/^@:/gi.test(v)&&this.bindEvent(o,v.split(":")[1],h,this.dataList,{index:i})}if("bp-model"===c.name){var p=o.getAttribute("bp-model"),b=p;if(/^@\./gi.test(p)){var y=p.split(".")[1];b=e+("."+y)}else/^@$/gi.test(p)?b=e:/^@{index}$/gi.test(p)&&(b="@{"+i+"}");b!==p&&o.setAttribute("bp-model",b),this.bindModel(o)}if("bp-show"===c.name){var g=o.getAttribute("bp-show"),m=g;if(/^@\./gi.test(g)){var L=g.split(".")[1];m=e+("."+L)}else/^@$/gi.test(g)&&(m=e);m!==g&&o.setAttribute("bp-show",m),this.bindShow(o)}}o.children.length>0&&this.bindForItemsRecursion(o.children,e,i)}}}},{key:"bindForItems",value:function(t,e,i){return this.bindForItemsRecursion(t,e,i),t}},{key:"observePath",value:function(t,e,i,r){var a=this;n.isArray(i)&&!function(){var n=t,o=e,s=void 0;i.forEach(function(t,e){/^\d+$/.test(t)&&(t=parseInt(t)),e<i.length-1?(n=n[t],o=o[t]):s=t}),a.observeKey(n,o,s,r)}()}},{key:"observeKey",value:function(t,e,i){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];n.isArray(i)?this.observePath(t,e,i,a):!function(){var o=t[i],s=e[i];n.isObject(o)?(Object.defineProperty(t,i,{get:function(){return o},set:function(t){t!==o&&(a&&a.forEach(function(e){e.call(r,o,t)}),s=t,o=t)},enumerable:!0,configurable:!0}),Object.keys(o).forEach(function(t){r.observeKey(o,s,t,a)})):n.isArray(o)?(Object.defineProperty(t,i,{get:function(){return o},set:function(t){t!==o&&(a&&a.forEach(function(e){e.call(r,o,t)}),s=t,o=t)},enumerable:!0,configurable:!0}),r.observeArray(o,s,a)):Object.defineProperty(t,i,{get:function(){return o},set:function(t){t!==o&&(a&&a.forEach(function(e){e.call(r,o,t)}),s=t,o=t,console.log(s))},enumerable:!0,configurable:!0})}()}},{key:"observeArray",value:function(t,e){var i=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=["copyWithin","fill","pop","push","reverse","shift","sort","splice","unshift"],a=Array.prototype,o=Object.create(a);r.forEach(function(r){Object.defineProperty(o,r,{enumerable:!0,configurable:!0,writable:!0,value:function(){for(var o,s,l=arguments.length,c=Array(l),u=0;u<l;u++)c[u]=arguments[u];var f=t.slice(),d=(o=a[r]).call.apply(o,[t].concat(c));(s=a[r]).call.apply(s,[e].concat(c));var h=t;return n&&n.forEach(function(t){t.call(i,f,h)}),d}})}),t.__proto__=o}},{key:"register",value:function t(e,i,n,r){var t=this.registers.find(function(t){if(Object.is(t.obj,e)&&(t.key===n||t.key.toString()===n.toString()))return t});t?t.fns.push(r):this.registers.push({obj:e,objPure:i,key:n,fns:[r]})}},{key:"attach",value:function(){var t=this;this.registers.forEach(function(e){t.observeKey(e.obj,e.objPure,e.key,e.fns)})}}],[{key:"isHTMLCollection",value:function(t){return"[object HTMLCollection]"===Object.prototype.toString.call(t)}},{key:"isArray",value:function(t){return Array.isArray(t)||"[object Array]"===Object.prototype.toString.call(t)}},{key:"isObject",value:function(t){return"[object Object]"===Object.prototype.toString.call(t)}},{key:"parseData",value:function(t,e){var i=t.split("."),n=e,r=[];return i.forEach(function(t,i){0===i?(n=e[t],r.push(t)):(n=n[t],r.push(t))}),{path:r,data:n}}},{key:"ignoreInnerDirectives",value:function(t,e,i){for(var n=arguments.length,r=Array(n>3?n-3:0),a=3;a<n;a++)r[a-3]=arguments[a];var o=this;e.forEach(function(e){e.test(t)&&i&&i.call.apply(i,[o].concat(r))}),/^@/gi.test(t)||i&&i.call.apply(i,[this].concat(r))}},{key:"clone",value:function(t){var i=void 0;if(null===t||"object"!==("undefined"==typeof t?"undefined":e(t)))return t;if(t instanceof Date)return i=new Date,i.setTime(t.getTime()),i;if(t instanceof Array){i=[];for(var r=0,a=t.length;r<a;r++)i[r]=n.clone(t[r]);return i}if(t instanceof Object){i={};for(var o in t)t.hasOwnProperty(o)&&(i[o]=n.clone(t[o]));return i}throw new Error("[Ballpen] Unable to copy object, type is not supported.")}}]),n}();return n});
//# sourceMappingURL=ballpen.min.js.map
